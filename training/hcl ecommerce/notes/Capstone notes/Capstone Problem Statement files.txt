Capstone files

Part 1
Step 1

-- CatEntryUpdate.csv

CatalogEntryUpdate
CatalogEntryUniqueId,PartNumber,Field3,Field4
12623,CAC024_2401,4.2,"RatingCompany2"
12624,CAC024_240101,4.3,"RatingCompany1"
12806,HBA031_3101,4.2,"RatingCompany2"
12807,HBA031_310101,4.2,"RatingCompany2"
12786,HME037_3701,1.2,"RatingCompany2"
12787,HME037_370101,3.2,"RatingCompany2"
12627,CAC024_2403,4.2,"RatingCompany2"
12628,CAC024_240301,3.1,"RatingCompany2"
12629,CAC024_2404,3.1,"RatingCompany2"
12630,CAC024_240401,3.1,"RatingCompany2"
12652,CDE021_2101,3.1,"RatingCompany2"
12653,CDE021_210101,3.1,"RatingCompany2"
12654,CDE021_2102,3.1,"RatingCompany2"
12655,CDE021_210201,3.1,"RatingCompany2"
12674,CTA023_2302,4.2,"RatingCompany2"
12675,CTA023_230201,4.2,"RatingCompany2"
12676,CTA023_2303,4.3,"RatingCompany2"
12677,CTA023_230301,1.2,"RatingCompany2"
12678,CTA023_2304,4.7,"RatingCompany2"
12679,CTA023_230401,4.5,"RatingCompany2"
12680,CTA023_2305,4.2,"RatingCompany2"
12681,CTA023_230501,4.2,"RatingCompany2"
12682,CTA023_2306,4.2,"RatingCompany2"
12683,CTA023_230601,4.2,"RatingCompany2"
12660,CLA022_2201,3.2,"RatingCompany2"
12661,CLA022_220101,2.2,"RatingCompany2"
12662,CLA022_2202,1.2,"RatingCompany2"
12663,CLA022_220201,3.1,"RatingCompany2"
12664,CLA022_2203,2.2,"RatingCompany2"
12665,CLA022_220301,1.2,"RatingCompany2"
12666,CLA022_2204,4.2,"RatingCompany2"
12667,CLA022_220401,4.2,"RatingCompany2"
12668,CLA022_2205,4.2,"RatingCompany2"
12669,CLA022_220501,4.2,"RatingCompany2"
12670,CLA022_2206,4.2,"RatingCompany2"
12671,CLA022_220601,4.2,"RatingCompany2"





-- wc-dataload-catalog-entry-update.xml

<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
-->
<_config:DataLoadConfiguration
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../xsd/wc-dataload.xsd" 
	xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config">

	<_config:DataLoadEnvironment configFile="wc-dataload-env.xml" />


    <_config:LoadOrder commitCount="100" batchSize="1" dataLoadMode="Update" >
<!--
-->
		<_config:property name="firstTwoLinesAreHeader" value="true" />
 	  <_config:LoadItem name="CatalogEntryUpdate" loadSequence="3.1" dataLoadMode="Update" businessObjectConfigFile="wc-loader-catalog-entry-update.xml">
             <_config:DataSourceLocation location="CatEntryUpdate.csv" oldLocation="" />
             <_config:BusinessContext languageId="-1"/>
		</_config:LoadItem>
               
    </_config:LoadOrder>

</_config:DataLoadConfiguration>






-- wc-dataload-env.xml

<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of IBM

  WebSphere Commerce

  (C) Copyright IBM Corp. 2009 All Rights Reserved.

  US Government Users Restricted Rights - Use, duplication or
  disclosure restricted by GSA ADP Schedule Contract with
  IBM Corp.
 =================================================================
-->
<_config:DataLoadEnvConfiguration
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../xsd/wc-dataload-env.xsd"
	xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config">

	<!--The global business context setting for the loader. Default setting is loading data to Madisions store's master catalog. If you want to load in different store or catalog, you need to update the storeIdentifier and catalogIdentifier in the following section.-->
	<!-- <_config:BusinessContext storeIdentifier="AuroraESite" catalogIdentifier="Extended Sites Catalog Asset Store" langId="-1" currency="USD" />  -->
	<_config:BusinessContext storeIdentifier="Extended Sites Catalog Asset Store" catalogIdentifier="Extended Sites Catalog Asset Store" langId="-1" currency="USD" />


	<!-- database setting for derby in Toolkit -->
	<!-- <_config:Database type="derby" name="..\db\mall" /> -->
	
	<!-- database setting for Oracle -->	
	<!-- 
	<_config:Database name="<database name>" user="<user>" password="<password>" port="1521" schema="<schema name>" server="<server>" type="Oracle" />
	-->	
	
	<!-- database setting for AIX/DB2 server -->
	<_config:Database type="db2" name="mall" user="wcs" password="SAMPLE_PASSWRD" server="localhost" port="50000" schema="wcs" />

	<_config:IDResolver className="com.ibm.commerce.foundation.dataload.idresolve.IDResolverImpl" cacheSize="10000000" />

	<_config:DataWriter className="com.ibm.commerce.foundation.dataload.datawriter.JDBCDataWriter" />

</_config:DataLoadEnvConfiguration>






-- wc-loader-catalog-entry-update.xml

<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
-->
<_config:DataloadBusinessObjectConfiguration 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../../../../xml/config/xsd/wc-dataload-businessobject.xsd" 
	xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config">

  <_config:DataLoader className="com.ibm.commerce.foundation.dataload.BusinessObjectLoader" >

    <_config:DataReader className="com.ibm.commerce.foundation.dataload.datareader.CSVReader"
          firstLineIsHeader="true" useHeaderAsColumnName="true" />

	<!--  Catalog Entry -->
    <_config:BusinessObjectBuilder className="com.ibm.commerce.foundation.dataload.businessobjectbuilder.BaseBusinessObjectBuilder"
      packageName="com.ibm.commerce.catalog.facade.datatypes.CatalogPackage" dataObjectType="CatalogEntryType" >

      <_config:DataMapping>
        <!-- The unique reference number of the catalog entry -->
        <_config:mapping xpath="CatalogEntryIdentifier/UniqueID" value="CatalogEntryUniqueId" />
		<_config:mapping xpath="CatalogEntryIdentifier/ExternalIdentifier/PartNumber" value="PartNumber" />
		<_config:mapping xpath="CatalogEntryAttributes/Attributes[3]/Name" value="field3" valueFrom="Fixed" />
        <!-- The catalog entry custom field 3 -->
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[3]/StringValue/value" value="Field3" />
        
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[4]/Name" value="field4" valueFrom="Fixed" />
        <!-- The catalog entry custom field 4 -->
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[4]/StringValue/value" value="Field4" />
      </_config:DataMapping>
      <_config:BusinessObjectMediator className="com.ibm.commerce.catalog.dataload.mediator.CatalogEntryMediator" componentId="com.ibm.commerce.catalog" >

        <_config:property name="createParentProductWhenMissing" value="false" />
        <_config:property name="validateCatalog" value="true" />
        <_config:property name="validateCatalogEntry" value="true" />
        <_config:property name="syncSalesCatalogs" value="true" />

      </_config:BusinessObjectMediator>
    </_config:BusinessObjectBuilder>

    <!--  Catalog Entry Search Index -->
    <_config:BusinessObjectBuilder className="com.ibm.commerce.foundation.dataload.businessobjectbuilder.BaseBusinessObjectBuilder"
      packageName="com.ibm.commerce.catalog.facade.datatypes.CatalogPackage" dataObjectType="CatalogEntryType" >

      <_config:DataMapping>
        <!-- The unique reference number of the catalog entry -->
        <_config:mapping xpath="CatalogEntryIdentifier/UniqueID" value="CatalogEntryUniqueId" />
        <!-- The part number of the catalog entry -->
        <_config:mapping xpath="CatalogEntryIdentifier/ExternalIdentifier/PartNumber" value="PartNumber" />
        
      </_config:DataMapping>
      <_config:BusinessObjectMediator className="com.ibm.commerce.catalog.dataload.mediator.CatalogEntrySearchIndexMediator" componentId="com.ibm.commerce.catalog" >
        <_config:property name="actionOnError" value="1" />
      </_config:BusinessObjectMediator>
    </_config:BusinessObjectBuilder>
	
  </_config:DataLoader>

</_config:DataloadBusinessObjectConfiguration>





Part 1 Step 2
-- WC/xml/search/dataImport/v1/db2/CatalogEntry/wc-dataimport-preprocess-x-finalbuild.xml

<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright  2016, 2017 All Rights Reserved.

  
  
  
 =================================================================
-->  
<_config:DIHPreProcessConfig xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../../xsd/wc-dataimport-preprocess.xsd ">

	<_config:data-processing-config processor="com.ibm.commerce.foundation.dataimport.preprocess.FinalViewDataPreProcessor"  fetchSize="500" batchSize="500">
		<_config:table definition="CREATE VIEW X_VI_CE_#INDEX_SCOPE_TAG#_#lang_tag# AS(
									SELECT 
										CATENTRY.CATENTRY_ID PK,
										CATENTRY.FIELD1 X_FIELD1_I,
										CATENTRY.FIELD2 X_FIELD2_I,
										CATENTRY.FIELD3 PRODUCT_RATING,
										CATENTRY.FIELD4 RATING_COMPANY,
										CATENTRY.FIELD5 X_FIELD5_SM,
										CATENTDESCOVR.FIELD1 X_FIELD1_NL_I,
										CATENTDESCOVR.FIELD2 X_FIELD2_NL_Q,
										CATENTDESCOVR.FIELD3 X_FIELD3_NL_S
									FROM CATENTRY
										INNER JOIN TI_CATENTRY_#INDEX_SCOPE_TAG# CE ON (CATENTRY.CATENTRY_ID=CE.CATENTRY_ID)
										LEFT OUTER JOIN CATENTDESCOVR ON (CATENTRY.CATENTRY_ID=CATENTDESCOVR.CATENTRY_ID))"	name="X_VI_CE_#INDEX_SCOPE_TAG#_#lang_tag#"/>
		
		<_config:query sql="SELECT 1 CATENTRY_ID FROM CATENTRY WHERE 1=-1"/>
		
		<_config:mapping>
		  <_config:key queryColumn="PK" tableColumn="PK"/>
		</_config:mapping>
	</_config:data-processing-config>
	
	<_config:data-processing-config processor="com.ibm.commerce.foundation.dataimport.preprocess.FinalViewDataPreProcessor"  fetchSize="500" batchSize="500">
		<_config:table definition="CREATE VIEW X_VI_UN_#INDEX_SCOPE_TAG#_#lang_tag# AS(
									SELECT rtrim(cast(ATCHREL.ATCHREL_ID as char(23))) ||'_'|| rtrim(cast(ATCHAST.ATCHAST_ID as char(23))) PK, 
										ATCHTGT.FIELD1 X_FIELD1_I,
										ATCHTGT.FIELD2 X_FIELD2_D,
										ATCHTGT.FIELD3 X_FIELD3_Q,
										ATCHTGT.FIELD4 X_FIELD4_SM
									FROM TI_CATENTRY_#INDEX_SCOPE_TAG# CE
										JOIN ATCHREL ON (ATCHREL.BIGINTOBJECT_ID = CE.CATENTRY_ID)
										LEFT JOIN ATCHTGT ON (ATCHREL.ATCHTGT_ID = ATCHTGT.ATCHTGT_ID )
										JOIN ATCHAST ON (ATCHAST.ATCHTGT_ID = ATCHTGT.ATCHTGT_ID))"	name="X_VI_UN_#INDEX_SCOPE_TAG#_#lang_tag#"/>
		
		<_config:query sql="SELECT 1 CATENTRY_ID FROM CATENTRY WHERE 1=-1"/>
		
		<_config:mapping>
		  <_config:key queryColumn="PK" tableColumn="PK"/>
		</_config:mapping>
	</_config:data-processing-config>
	    
</_config:DIHPreProcessConfig>





-- search-config-ext/src/index/managed-solr/config/CatalogEntry/x-schema.xml

<?xml version="1.0" encoding="UTF-8" ?>
<fields>

	<!-- WebSphere Commerce text field naming convention: <fieldName>: tokenized 
		and case insensitive, i.e. mfName <fieldName>_cs: tokenized and case sensitive, 
		i.e. mfName_cs <fieldName>_ntk: non-tokenized and case insensitive, i.e. 
		mfName_ntk <fieldName>_ntk_cs: non-tokenized and case sensitive, i.e. catenttype_id_ntk_cs -->

	<!-- Catentry's basic attributes: map to table CATENTRY -->
	<field name="mfName" type="wc_text_${lang:en}" indexed="true" stored="true" multiValued="false" />
	<field name="partNumber_ntk" type="wc_keywordTextLowerCase" indexed="true" stored="true" multiValued="false" />
	<field name="mfPartNumber_ntk" type="wc_keywordTextLowerCase" indexed="true" stored="true" multiValued="false" />
	<field name="mfName_ntk_cs" type="wc_keywordText" indexed="true" stored="true" multiValued="false" />
	<field name="mfName_ntk" type="wc_keywordTextLowerCase" indexed="true" stored="true" multiValued="false" />
	<field name="catenttype_id_ntk_cs" type="wc_keywordText" indexed="true" stored="true" multiValued="false" />

	<!-- Catentry's description: map to table CATENTDESC -->
	<field name="name" type="wc_text_${lang:en}" indexed="true" stored="true" multiValued="false" />
	<field name="shortDescription" type="wc_text_${lang:en}" indexed="true" stored="true" multiValued="false" />
	<field name="longDescription" type="string" indexed="false" stored="true" multiValued="false" />
	<field name="keyword" type="wc_text_${lang:en}" indexed="true" stored="true" multiValued="false" />

	<field name="name_ntk" type="wc_keywordTextLowerCase" indexed="true" stored="false" multiValued="false" />

	<!-- Catentry's description override: map to table CATENTDESCOVR -->
	<field name="nameOverride" type="wc_text_${lang:en}" indexed="true" stored="true" multiValued="true" />
	<field name="shortDescriptionOverride" type="wc_text_${lang:en}" indexed="true" stored="true" multiValued="true" />
	<field name="keywordOverride" type="wc_text_${lang:en}" indexed="true" stored="true" multiValued="true" />
	<field name="publishedOverride" type="wc_text_${lang:en}" indexed="true" stored="true" multiValued="true" />

	<!-- Catentry's contracted price or standard offer price -->
	<dynamicField name="price_*" type="wc_price" indexed="true" stored="true" multiValued="false" />

	<!-- Catentry's attribute dictionary attributes: map to tables in attribute 
		dictionary -->
	<dynamicField name="ads_f*" type="wc_text_${lang:en}" indexed="true" stored="true" multiValued="true" />

	<!-- Catentry's direct parent catalog group in master catalog: map to table 
		CATGPENREL -->
	<field name="parentCatgroup_id_facet" type="wc_keywordText" indexed="true" stored="true" multiValued="true" />

	<!-- Catentry's direct parent catalog group: map to table CATGPENREL -->
	<field name="parentCatgroup_id_search" type="wc_keywordText" indexed="true" stored="true" multiValued="true" />

	<!-- Catentry's full navigation path: map to table CATGPENREL -->
	<field name="parentCatgroup_id_path" type="wc_keywordText" indexed="true" stored="true" multiValued="true" />

	<!-- Catentry's display sequence: map to table: CATGPENREL -->
	<field name="sequence" type="wc_keywordText" indexed="true" stored="true" multiValued="true" />

	<!-- Catentry's display sequence: map to table: TI_ENTGRPPATH_#INDEXSCOPE# -->
	<field name="globalSequence" type="wc_keywordText" indexed="true" stored="true" multiValued="true" />

	<!-- Components of bundle's and packages based on the CATENTREL table. catentry_id/_/quantity -->
	<field name="components" type="wc_keywordText" indexed="true" stored="true" multiValued="true" />

	<!-- Catentry's display sequence: map to table: SEOURL -->
	<field name="seo_token_ntk" type="wc_keywordTextLowerCase" indexed="true" stored="true" multiValued="false" />

	<!-- Categoryname field -->
	<field name="categoryname" type="wc_text_${lang:en}" indexed="true" stored="false" multiValued="true" />

	<!-- Spell check field -->
	<field name="spellCheck" type="wc_textSpell_${lang:en}" indexed="true" stored="false" multiValued="true" />


	<!-- Spell correction field -->
	<field name="spellCorrection" type="wc_textSpellCorrection_${lang:en}" indexed="true" stored="false" multiValued="true" />

	<!-- Spell check dynamic field based on store and Catalog specific fields. 
		It is being populated by the ConditionalCopyFieldProcessorFactory -->
	<dynamicField name="spellCheck*" type="wc_textSpell_${lang:en}" indexed="true" stored="false" multiValued="true" />

	<!-- Term Suggest field is used to generate keyword suggestions as an alternatives 
		of TermsComponent when SearchBasedKeywordSuggestions is set in wc-component.xml. -->
	<field name="term_suggest" type="wc_termSuggest" indexed="true" stored="true" multiValued="true" />
	<field name="defaultTerms" type="wc_termSuggest" indexed="true" stored="true" multiValued="true" />

	<!-- Displayable attributes: map to ATTR, ATTRDESC, ATTRVAL,ATTRVALDESC 
		and CATENTRYATTR tables -->
	<field name="ad_attribute" type="wc_keywordText" indexed="true" stored="true" multiValued="true" />

	<!-- dynamicKit properties: map to DKPREDEFCONF , DKPDCCATENTREL, DKPDCCOMPLIST, 
		and CATCONFINF tables -->
	<field name="dkURL" type="wc_text_${lang:en}" indexed="true" stored="true" multiValued="false" />
	<field name="dkDefaultConfiguration" type="wc_text_${lang:en}" indexed="true" stored="true" multiValued="false" />

	<!-- PDKs of DynamicKit based on the CATENTREL table. catentry_id/_/quantity -->
	<field name="pdks" type="wc_keywordText" indexed="true" stored="true" multiValued="true" />

	<!-- Default searchable field -->
	<field name="defaultSearch" type="wc_text_${lang:en}" indexed="true" stored="false" multiValued="true" />

	<!-- product suggestions fields -->
	<field name="name_suggest" type="wc_textSuggest" indexed="true" stored="false" multiValued="false" />
	<field name="shortDesc_suggest" type="wc_textSuggest" indexed="true" stored="false" multiValued="true" />
	<field name="partNumber_suggest" type="wc_textSuggest" indexed="true" stored="false" multiValued="true" />
	<field name="defaultSuggest" type="wc_textSuggest" indexed="true" stored="false" multiValued="true" />

	<!-- Unstructured content field -->
	<field name="unstructure" type="wc_text_${lang:en}" indexed="true" stored="false" multiValued="true" />

    <!-- for ratings reviews custom -->
	<field name="customerRanking" type="tfloat" indexed="true" stored="false" multiValued="false" />
	<field name="customerRanking_display" type="float" indexed="true" stored="true" multiValued="false" />
	<copyField source="customerRanking" dest="customerRanking_display"/>
	<!-- for ratings reviews custom -->
	
	<field name="productRanking" type="tfloat" indexed="true" stored="false" multiValued="false" />
	<field name="productRanking_display" type="float" indexed="true" stored="true" multiValued="false" />
	<copyField source="productRanking" dest="productRanking_display"/>
	
	<field name="ratingCompany" type="text" indexed="true" stored="false" multiValued="false" />
	<field name="ratingCompany_display" type="text" indexed="true" stored="true" multiValued="false" />
	<copyField source="ratingCompany" dest="ratingCompany_display"/> 

	<!-- Copy fields -->
	<copyField source="name" dest="name_ntk" />
	<copyField source="mfName" dest="mfName_ntk_cs" />
	<copyField source="mfName" dest="mfName_ntk" />

	<!-- Copy fields for default search field -->
	<copyField source="name" dest="defaultSearch" />
	<copyField source="shortDescription" dest="defaultSearch" />
	<copyField source="partNumber_ntk" dest="defaultSearch" />
	<copyField source="keyword" dest="defaultSearch" />
	<copyField source="nameOverride" dest="defaultSearch" />
	<copyField source="shortDescriptionOverride" dest="defaultSearch" />
	<copyField source="keywordOverride" dest="defaultSearch" />
	<copyField source="categoryname" dest="defaultSearch" />

	<!-- copy filed statement to populate static spellCheck field used by Solr 
		TermComponent for keyword Suggestions -->
	<copyField source="name" dest="spellCheck" />
	<copyField source="shortDescription" dest="spellCheck" />
	<copyField source="keyword" dest="spellCheck" />
	<copyField source="nameOverride" dest="spellCheck" />
	<copyField source="shortDescriptionOverride" dest="spellCheck" />
	<copyField source="keywordOverride" dest="spellCheck" />

	<!-- Copy fields for spell correction -->
	<copyField source="name" dest="spellCorrection" />
	<copyField source="shortDescription" dest="spellCorrection" />
	<copyField source="keyword" dest="spellCorrection" />
	<copyField source="nameOverride" dest="spellCorrection" />
	<copyField source="shortDescriptionOverride" dest="spellCorrection" />
	<copyField source="keywordOverride" dest="spellCorrection" />

	<!-- Copy suggestions fields -->
	<copyField source="name" dest="name_suggest" />
	<copyField source="shortDescription" dest="shortDesc_suggest" />
	<copyField source="partNumber_ntk" dest="partNumber_suggest" />

	<!-- Copy fields for term_suggest -->
	<copyField source="name" dest="term_suggest" />
	<copyField source="shortDescription" dest="term_suggest" />
	<copyField source="keyword" dest="term_suggest" />
	<copyField source="nameOverride" dest="term_suggest" />
	<copyField source="shortDescriptionOverride" dest="term_suggest" />
	<copyField source="keywordOverride" dest="term_suggest" />


	<!-- ============================================================================== -->
	<!-- Generic copy field assignments -->
	<!-- ============================================================================== -->
	<copyField source="*_q" dest="defaultSearch" />
	<copyField source="*_q" dest="spellCheck" />
	<copyField source="*_q" dest="spellCorrection" />
	<copyField source="*_q" dest="defaultTerms" />
	<copyField source="*_q" dest="defaultSuggest" />

	<copyField source="*_qm" dest="defaultSearch" />
	<copyField source="*_qm" dest="spellCheck" />
	<copyField source="*_qm" dest="spellCorrection" />
	<copyField source="*_qm" dest="defaultTerms" />
	<copyField source="*_qm" dest="defaultSuggest" />

</fields>






-- search-config-ext/src/index/managed-solr/config/v3/CatalogEntry/x-data-config.xml


<?xml version="1.0" encoding="UTF-8" ?>
<xi:include parse="text" xmlns:xi="http://www.w3.org/2001/XInclude">
    <xi:fallback>

		<!-- Here are CLOB fields that couldn't be changed before 9.0.1.1 and 9.0.0.10.
		     
		     We know that CLOB processing is slow.
		     The purpose of moving them here is let users decide whether to use CLOB in data import.
		     And it's better to match temporary table fields and the corresponding one in DIH.
		 -->

		<field column="LONGDESCRIPTION"	name="longDescription" clob="true" />
        <field column="CATGRPNAME" clob="true" />
        <field column="ENTGRPPATH" clob="true" />
        <field column="CNTRPRICE" clob="true" />
        <field column="DKDEFAULTCONFIG" clob="true" />
    	<field column="PRODUCT_RATING" name="productRanking"/>
        <field column="RATING_COMPANY" name="ratingCompany"/>

		<!-- If you change to use CLOB in preprocessing, make sure uncomment corresponding column below. -->

		<!-- 
        <field column="NAME_OVR" clob="true" />
        <field column="SHORTDESC_OVR" clob="true" />
        <field column="KEYWORD_OVR" clob="true" />
        <field column="PUBLISHED_OVR" clob="true" />

        <field column="CATENTRY_ATTRIBUTES" clob="true" />

        <field column="ATTRS" clob="true" />
        <field column="ATTRI" clob="true" />
        <field column="ATTRF" clob="true" />
		<field column="SRCHS" clob="true" />
		<field column="SRCHI" clob="true" />
		<field column="SRCHF" clob="true" />
     	-->
    
        <!-- Uncomment the following mapping and put customized data config below.
             If you did the customization previously, you can find them in x:\WCDE_V9\UpdateDelta\9.0.1.n\backup
        -->
        <!--<field column="COLUMN1" name="matchField1"/>-->
        <!--<field column="COLUMN2" name="matchField2"/>-->
        <field column="RATING" name="customerRanking"/>
    </xi:fallback>
</xi:include>






-- search-config-ext/src/runtime/config/com.ibm.commerce.search/wc-search.xml

<?xml version="1.0" encoding="UTF-8"?>

<_config:search-config
	xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config"
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../xsd/wc-search.xsd ">

	<_config:server name="BasicConfiguration">
		<_config:embedded />
	</_config:server>
	
<_config:profile name="IBM_findProductsBySearchTerm" indexName="CatalogEntry">
  <_config:query>  
    <_config:postprocessor 
    classname="com.ibm.commerce.foundation.server.services.rest.search.postprocessor.solr.SolrRESTSearchCatalogEntryViewUserDataQueryPostprocessor" />  
  </_config:query>   
  <_config:result>        
    <_config:field name="productRating_display"/>
    <_config:field name="ratingCompany_display"/>
  </_config:result>            
</_config:profile>
	
</_config:search-config>







-- SQL for inserting data in search related tables

ERT INTO srchattr (SRCHATTR_ID, INDEXSCOPE, INDEXTYPE, IDENTIFIER, OPTCOUNTER) 
VALUES (10002, '0', 'CatalogEntry', '_cat.productRanking', 0);
INSERT INTO srchattr (SRCHATTR_ID, INDEXSCOPE, INDEXTYPE, IDENTIFIER, OPTCOUNTER) 
VALUES (10003, '0', 'CatalogEntry', '_cat.ratingCompany', 0);
INSERT INTO srchattrprop (SRCHATTR_ID, PROPERTYNAME, PROPERTYVALUE, OPTCOUNTER) 
VALUES (10002, 'merchandising-Sort-Numeric', 'productRanking', 0);
INSERT INTO srchattrprop (SRCHATTR_ID, PROPERTYNAME, PROPERTYVALUE, OPTCOUNTER) 
VALUES (10003, 'merchandising-Filter-ExactText', 'ratingCompany', 0);
INSERT INTO srchattrdesc (SRCHATTR_ID, LANGUAGE_ID, DISPLAYNAME, DESCRIPTION) 
VALUES (10002, -1, 'Product Ranking', null);
INSERT INTO srchattrdesc (SRCHATTR_ID, LANGUAGE_ID, DISPLAYNAME, DESCRIPTION) 
VALUES (10003, -1, 'Rating Company', null);






-- CURL command for getting buildingIndex status

curl --user spiuser:passw0rd --insecure -X GET https://localhost:443/wcs/resources/admin/index/dataImport/status?jobStatusId=11001   





-- CURL command for buildingIndex
curl --user spiuser:passw0rd --insecure -X POST https://localhost:443/wcs/resources/admin/index/dataImport/build?masterCatalogId=10001  






-- CatalogEntryDisplay_GridView.jspf file we customized to display data from UserData

<%--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
--%>

<flow:ifEnabled feature="Analytics">
	<c:if test="${fn:contains(catEntryDisplayUrl, '?')}">
		<c:set var="cmcrurl" value="${fn:replace(cmcrurl, '?', '&')}" />
		<c:if test="${!empty cmcrurl}">
			<c:set var="cmcrurl_productImageLink"
				value="${cmcrurl}-productImageLink" />
			<c:set var="cmcrurl_productNameLink"
				value="${cmcrurl}-productNameLink" />
		</c:if>
	</c:if>
</flow:ifEnabled>

<c:choose>
	<c:when test="${disableProductCompare == 'false'}">
		<c:set var="showCompareBox" value="true" />
	</c:when>
	<c:otherwise>
		<c:set var="showCompareBox" value="false" />
	</c:otherwise>
</c:choose>
<c:if
	test="${type eq 'package' || type eq 'bundle' || type eq 'dynamickit' || type eq 'preddynakit'}">
	<c:set var="showCompareBox" value="false" />
</c:if>

<div id="CatalogEntryProdImg_${catalogEntryID}" class="product_image">
	<div
		dataci_product="<c:out value='${param.pgl_widgetId}_${partNumber}'/>"
		class="image"
		id="ci_product_<c:out value='${param.pgl_widgetId}_${partNumber}'/>">
		<a ${ShowProductInNewWindow} id="catalogEntry_img${catalogEntryID}"
			href="${fn:escapeXml(catEntryDisplayUrl)}${fn:escapeXml(cmcrurl_productImageLink)}"
			title="${altImgText}"> <img alt="" src="${imgSource}" /> <c:forEach
				var="adRibbon" items="${adRibbonMap}">
				<c:set var="adRibbonStyle"
					value="RibbonAdDefault ${fn:replace(adRibbon.key , '\"' , '_')}" />
				<div class="${fn:escapeXml(adRibbonStyle)}">${adRibbon.value}</div>
			</c:forEach>
		</a>
	</div>
</div>
<div class="product_info">
	<div class="product_name">
		<c:choose>
			<c:when
				test="${!empty catalogEntryDetails.UserData[0].x_customerRanking}">
				<div>
					<c:out
						value="Rating : ${catalogEntryDetails.UserData[0].x_customerRanking}" />
				</div>
			</c:when>
			<c:otherwise>
				<div>
					<c:out value="Rating : N/A" />
				</div>
			</c:otherwise>
		</c:choose>
		<c:choose>
			<c:when
				test="${!empty catalogEntryDetails.UserData[0].x_productRanking && !empty catalogEntryDetails.UserData[0].x_ratingCompany}">
				<div>
					<c:out
						value="Product Rating: ${catalogEntryDetails.UserData[0].x_productRanking}" />
						<br/>
					<c:out
						value="Rating Company: ${catalogEntryDetails.UserData[0].x_ratingCompany}" />
				</div>
			</c:when>
		</c:choose>
		<c:if test="${not empty searchScore}">
			<div class="searchScore">
				[
				<wcst:message key='SEARCH_SCORE' bundle="${widgetText}" />
				<c:out value="${searchScore}" />
				]
			</div>
		</c:if>
		<a aria-hidden="true" tabindex="-1"
			id="WC_CatalogEntryDBThumbnailDisplayJSPF_${catalogEntryID}_link_9b"
			${ShowProductInNewWindow}
			href="${fn:escapeXml(catEntryDisplayUrl)}${fn:escapeXml(cmcrurl_productNameLink)}"><c:out
				value="${highlightedName}" escapeXml="${env_escapeXmlFlag}" /></a>
	</div>
	<div class="product_price" id="product_price_${catalogEntryID}">
		<%@include file="/Widgets_801/Common/PriceDisplay/PriceDisplay.jspf"%>
	</div>
</div>


<c:choose>
	<c:when test="${showCompareBox eq 'true'}">
		<div id="compare_${fn:escapeXml(catalogEntryID)}"
			class="compare_target">
			<input id="comparebox_${fn:escapeXml(catalogEntryID)}"
				type="checkbox" name="comparebox_${fn:escapeXml(catalogEntryID)}"
				value="${fn:escapeXml(catalogEntryID)}"
				onchange="javascript:shoppingActionsJS.addOrRemoveFromCompare('${fn:escapeXml(catalogEntryID)}',this.checked)" />
			<label for="comparebox_${fn:escapeXml(catalogEntryID)}"><wcst:message
					key="COMPARE" bundle="${widgetText}" /></label> <a
				id="compareButton_${fn:escapeXml(catalogEntryID)}"
				href="javascript:shoppingActionsJS.compareProducts(<c:out value='${categoryIds}'/>,'${WCParam.manufacturer}');"
				role="button"
				aria-label="<wcst:message key="COMPARE" bundle="${widgetText}"/>"><wcst:message
					key="COMPARE" bundle="${widgetText}" /></a>
		</div>
	</c:when>
	<c:otherwise>
		<div id="compare_${fn:escapeXml(catalogEntryID)}"
			class="compare_target compare_target_hidden">
			<input id="comparebox_${fn:escapeXml(catalogEntryID)}"
				type="checkbox" name="comparebox_${fn:escapeXml(catalogEntryID)}"
				value="${fn:escapeXml(catalogEntryID)}"
				onchange="javascript:shoppingActionsJS.addOrRemoveFromCompare('${fn:escapeXml(catalogEntryID)}',this.checked)" />
			<label for="comparebox_${fn:escapeXml(catalogEntryID)}"><wcst:message
					key="COMPARE" bundle="${widgetText}" /></label> <a
				id="compareButton_${fn:escapeXml(catalogEntryID)}"
				href="javascript:shoppingActionsJS.compareProducts(<c:out value='${categoryIds}'/>,'${WCParam.manufacturer}');"
				role="button"
				aria-label="<wcst:message key="COMPARE" bundle="${widgetText}"/>"><wcst:message
					key="COMPARE" bundle="${widgetText}" /></a>
		</div>
	</c:otherwise>
</c:choose>
<c:if test="${showCompareBox eq 'true' and param.fromPage ne 'compare'}">
	<script>
		if($("#comparebox_${fn:escapeXml(catalogEntryID)}").checked){
			$( document ).ready(function() {
				$("#comparebox_${fn:escapeXml(catalogEntryID)}").checked = '';
			});
		}
	</script>
</c:if>

<c:if
	test="${param.showAddToCart == 'true' && enableSKUListView != 'true'}">
	<c:choose>
		<c:when
			test="${(requestScope.bundleKitAvailable eq 'true') or (requestScope.productAvailable eq 'true') or (requestScope.dynamicKitAvailable eq 'true')}">
			<flow:ifDisabled feature="HidePurchaseButton">
				<c:choose>
					<c:when
						test="${(type == 'dynamickit' || type == 'preddynakit') && showDynamicKit == 'true'}">
						<%@ include
							file="CatalogEntryDisplayForDynamicKits_ImageView.jspf"%>
					</c:when>
					<c:when
						test="${type == 'item' || type == 'package' || type == 'product'}">
						<c:choose>
							<c:when test="${!hasAssociations}">
								<%-- APPLEPAY BEGIN --%>
								<flow:ifEnabled feature="ApplePay">
									<div class="product_option">
										<a class="apple-pay-button left apple-pay-plp"
											id="applePayButtonDiv_${fn:escapeXml(catalogEntryID)}"
											wairole="button" role="button"
											aria-label="<wcst:message key="APPLE_PAY_BUTTON" bundle="${widgetText}"/>"
											onclick="javascript: applePayButtonClicked('entitledItem_<c:out value='${catalogEntryID}'/>', document.getElementById('quantity_<c:out value='${catalogEntryID}'/>').value, null, 'plp');"
											href="javascript:void(0);"></a>
										<div class="clear_float"></div>
									</div>
								</flow:ifEnabled>
								<%-- APPLEPAY END --%>
								<div class="product_option">
									<a id="listViewAdd2Cart_${fn:escapeXml(catalogEntryID)}"
										href="javascript:setCurrentId('listViewAdd2Cart_${fn:escapeXml(catalogEntryID)}');shoppingActionsJS.Add2ShopCartAjax('entitledItem_${fn:escapeXml(catalogEntryID)}',document.getElementById('quantity_${fn:escapeXml(catalogEntryID)}') != null ? document.getElementById('quantity_${fn:escapeXml(catalogEntryID)}').value : 1, false)"
										onKeyPress="javascript:MessageHelper.setFocusElement('listViewAdd2Cart_${fn:escapeXml(catalogEntryID)}');"
										class="button primary" wairole="button" role="button"
										title="<wcst:message key='ADD_TO_CART' bundle='${widgetText}' />">
										<wcst:message key="ADD_TO_CART" bundle="${widgetText}" />
									</a>
								</div>
							</c:when>
							<c:otherwise>
								<%-- APPLEPAY BEGIN --%>
								<flow:ifEnabled feature="ApplePay">
									<div class="product_option">
										<a class="apple-pay-button"
											id="applePayButtonDiv_${fn:escapeXml(catalogEntryID)}"
											wairole="button" role="button"
											aria-label="<wcst:message key="APPLE_PAY_BUTTON" bundle="${widgetText}"/>"
											onclick="javascript: applePayButtonClicked('entitledItem_<c:out value='${catalogEntryID}'/>', document.getElementById('quantity_<c:out value='${catalogEntryID}'/>').value, null, 'ma', 'entitledItem_<c:out value='${productDetailsPageCatalogEntryID}'/>', ${associationIndex});"
											href="javascript:void(0);"></a>
										<div class="clear_float"></div>
									</div>
									<div class="item_spacer_8px"></div>
								</flow:ifEnabled>
								<%-- APPLEPAY END --%>
								<div class="product_option">
									<a id="addBothToCartBtn_${fn:escapeXml(catalogEntryID)}"
										href="javascript:setCurrentId('addBothToCartBtn_${fn:escapeXml(catalogEntryID)}');MerchandisingAssociationJS.addBoth2ShopCart('entitledItem_<c:out value='${productDetailsPageCatalogEntryID}'/>','entitledItem_${fn:escapeXml(catalogEntryID)}',document.getElementById('quantity_${fn:escapeXml(catalogEntryID)}').value,${associationIndex});"
										class="button primary" wairole="button" role="button"
										title="<wcst:message key="MA_ADD_BOTH_TO_CART" bundle="${widgetText}"/>">
										<wcst:message key="MA_ADD_BOTH_TO_CART" bundle="${widgetText}" />
									</a>
								</div>
							</c:otherwise>
						</c:choose>
						<input type="hidden" id="ProductInfoName_${catalogEntryID}"
							value="<c:out value='${highlightedName}' escapeXml='${env_escapeXmlFlag}'/>" />
						<input type="hidden" id="ProductInfoImage_${catalogEntryID}"
							value="${fn:escapeXml(productThumbNailImage)}" />
					</c:when>
					<c:otherwise>
						<c:if test="${hasAssociations}">
							<div class="product_option">
								<a id="viewFullDetailsLink_${fn:escapeXml(catalogEntryID)}"
									href="${fn:escapeXml(productDisplayUrl)}${fn:escapeXml(cmcrurl_productFullDetailsLink)}"
									class="button primary" wairole="button" role="button"
									title="<wcst:message key="QI_VIEW_FULL_DETAILS" bundle="${widgetText}"/>">
									<wcst:message key="QI_VIEW_FULL_DETAILS" bundle="${widgetText}" />
								</a>
							</div>
						</c:if>
					</c:otherwise>
				</c:choose>
			</flow:ifDisabled>
		</c:when>
		<c:otherwise>
			<div class="product_option disabled">
				<div onclick="" class="button primary">
					<wcst:message key="PD_UNAVAILABLE" bundle="${widgetText}" />
				</div>
			</div>
		</c:otherwise>
	</c:choose>
</c:if>

<c:if test="${param.showRemoveButton == 'true'}">
	<c:choose>
		<c:when test="${sharedWishList}">
			<div class="product_option">
				<a class="button secondary" wairole="button" role="button"
					href="<c:out value="${interestItemDeleteURL}"/>"
					id="WC_CatalogEntryDBThumbnailDisplayJSPF_<c:out value='${catEntryIdentifier}'/>_links_14"
					waistate:controls="MiniShoppingCart"> <span class="remove">&nbsp;</span>
					<wcst:message bundle="${widgetText}" key="WISHLIST_REMOVE" />
				</a>
			</div>
		</c:when>
		<c:otherwise>
			<div class="product_option">
				<a class="button secondary" wairole="button" role="button"
					href="javaScript:MultipleWishLists.removeItem('<c:out value='${param.giftListItemID}'/>')"
					id="WC_CatalogEntryDBThumbnailDisplayJSPF_<c:out value='${catEntryIdentifier}'/>_links_14">
					<span class="remove">&nbsp;</span> <wcst:message
						bundle="${widgetText}" key="WISHLIST_REMOVE" />
				</a>
			</div>
		</c:otherwise>
	</c:choose>
</c:if>












Part 1 Step 3

-- AttributeDictionaryAttributeAndAllowedValues.csv

AttributeDictionaryAttributeAndAllowedValues,,,,,,,,,,,,
Identifier,Type,AttributeType,Sequence,Displayable,StoreDisplay,Comparable,Facetable,Searchable,Merchandisable,Name,AllowedValue1,AllowedValue2,AllowedValue3,AllowedValue4,AllowedValue5,Delete
GiftWrappable,STRING,AllowedValues,2,true,0,false,false,false,false,Gift Wrappable,Yes,No,,,,,




-- CatalogEntryAttributeDictionaryAttributeRelationship.csv

CatalogEntryAttributeDictionaryAttributeRelationship,,,,,,
PartNumber,AttributeIdentifier,ValueIdentifier,Value,Usage,Sequence,Delete
CAC024_2401,GiftWrappable,Yes,,Descriptive,2
CAC024_240101,GiftWrappable,Yes,,Descriptive,2,
HBA031_3101,GiftWrappable,Yes,,Descriptive,2
HBA031_310101,GiftWrappable,Yes,,Descriptive,2
HME037_3701,GiftWrappable,Yes,,Descriptive,2
HME037_370101,GiftWrappable,Yes,,Descriptive,2
CAC024_2403,GiftWrappable,Yes,,Descriptive,2
CAC024_240301,GiftWrappable,Yes,,Descriptive,2
CAC024_2404,GiftWrappable,Yes,,Descriptive,2
CAC024_240401,GiftWrappable,Yes,,Descriptive,2
CDE021_2101,GiftWrappable,Yes,,Descriptive,2
CDE021_210101,GiftWrappable,Yes,,Descriptive,2
CDE021_2102,GiftWrappable,Yes,,Descriptive,2
CDE021_210201,GiftWrappable,Yes,,Descriptive,2
CTA023_2302,GiftWrappable,Yes,,Descriptive,2
CTA023_230201,GiftWrappable,Yes,,Descriptive,2
CTA023_2303,GiftWrappable,Yes,,Descriptive,2
CTA023_230301,GiftWrappable,Yes,,Descriptive,2
CTA023_2304,GiftWrappable,Yes,,Descriptive,2
CTA023_230401,GiftWrappable,Yes,,Descriptive,2
CTA023_2305,GiftWrappable,Yes,,Descriptive,2
CTA023_230501,GiftWrappable,Yes,,Descriptive,2
CTA023_2306,GiftWrappable,Yes,,Descriptive,2
CTA023_230601,GiftWrappable,Yes,,Descriptive,2
CLA022_2201,GiftWrappable,Yes,,Descriptive,2
CLA022_220101,GiftWrappable,Yes,,Descriptive,2
CLA022_2202,GiftWrappable,Yes,,Descriptive,2
CLA022_220201,GiftWrappable,Yes,,Descriptive,2
CLA022_2203,GiftWrappable,Yes,,Descriptive,2
CLA022_220301,GiftWrappable,Yes,,Descriptive,2
CLA022_2204,GiftWrappable,Yes,,Descriptive,2
CLA022_220401,GiftWrappable,Yes,,Descriptive,2
CLA022_2205,GiftWrappable,Yes,,Descriptive,2
CLA022_220501,GiftWrappable,Yes,,Descriptive,2
CLA022_2206,GiftWrappable,Yes,,Descriptive,2
CLA022_220601,GiftWrappable,Yes,,Descriptive,2





-- CleanUp.sql

delete from attr where identifier in ('GiftWrappableDesc');





-- wc-dataload.xml

<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
-->
<_config:DataLoadConfiguration
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../../../../xml/config/xsd/wc-dataload.xsd" 
	xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config">

  <_config:DataLoadEnvironment configFile="wc-dataload-env.xml" />

  <_config:LoadOrder commitCount="100" batchSize="1" dataLoadMode="Replace">
  	   <_config:property name="firstTwoLinesAreHeader" value="true" />
  	   <_config:LoadItem name="AttributeDictionaryAttributeAndAllowedValues" businessObjectConfigFile="wc-loader-AD-attribute-and-allowed-values.xml" >
  	        <_config:DataSourceLocation location="AttributeDictionaryAttributeAndAllowedValues.csv" oldLocation="" />
  	   </_config:LoadItem>
  	   <_config:LoadItem name="CatalogEntryAttributeDictionaryAttributeRelationship" businessObjectConfigFile="wc-loader-catalog-entry-AD-attribute-relationship.xml" >
  	        <_config:DataSourceLocation location="CatalogEntryAttributeDictionaryAttributeRelationship.csv" oldLocation="" />
  	   </_config:LoadItem>
  </_config:LoadOrder> 

</_config:DataLoadConfiguration>






-- wc-dataload.env.xml

<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
-->

<_config:DataLoadEnvConfiguration
    xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
    xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../../../xml/config/xsd/wc-dataload-env.xsd"
    xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config">

	<!-- <_config:BusinessContext storeIdentifier="AuroraESite" >
	</_config:BusinessContext> -->
	<!-- <_config:BusinessContext storeIdentifier="AuroraESite" catalogIdentifier="Extended Sites Catalog Asset Store Consumer Direct" langId="-1" currency="USD" />  -->
	<_config:BusinessContext storeIdentifier="Extended Sites Catalog Asset Store" catalogIdentifier="Extended Sites Catalog Asset Store Consumer Direct" langId="-1" currency="USD" />
	
	<!-- database setting for derby in Toolkit -->
	<!-- <_config:Database type="derby" name="..\db\mall" schema="APP"/> -->
	
	<!-- database setting for Oracle -->
	<!--
	<_config:Database name="<database name>" user="<user>" password="<password>"
	port="1521" schema="<schema name>" server="<server>" type="Oracle" />
	-->
	
	<!-- database setting for AIX/DB2 server -->
	<_config:Database type="db2" name="mall" user="wcs" password="SAMPLE_PASSWRD" server="localhost" port="50000" schema="wcs" />
	<!--
	<_config:Database type="db2" name="<database name>" user="<user>" password="<password>" server="<server>" port="<port>" schema="<schema>" />
	-->
	
	<_config:IDResolver className="com.ibm.commerce.foundation.dataload.idresolve.IDResolverImpl" cacheSize="0"/>
	
	<_config:DataWriter className="com.ibm.commerce.foundation.dataload.datawriter.JDBCDataWriter" />

</_config:DataLoadEnvConfiguration>





-- wc-loader-AD-attribute-and-allowed-values.xml

<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
-->
<_config:DataloadBusinessObjectConfiguration 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../../../../xml/config/xsd/wc-dataload-businessobject.xsd" 
	xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config">

  <_config:DataLoader className="com.ibm.commerce.foundation.dataload.BusinessObjectLoader" >
    <!--
    <_config:ColumnExclusionList>
      <_config:table name="ATTR" columns="FACETABLE" />
    </_config:ColumnExclusionList>
    -->
    <_config:DataReader className="com.ibm.commerce.foundation.dataload.datareader.CSVReader" firstLineIsHeader="true" useHeaderAsColumnName="true" >
        <_config:property name="keyColumns" value="Identifier" />
    </_config:DataReader>
    <_config:BusinessObjectBuilder className="com.ibm.commerce.foundation.dataload.businessobjectbuilder.BaseBusinessObjectBuilder"
      packageName="com.ibm.commerce.catalog.facade.datatypes.CatalogPackage" dataObjectType="AttributeDictionaryAttributeType" >
      <_config:DataMapping>
        <_config:mapping xpath="AttributeIdentifier/ExternalIdentifier/Identifier" value="Identifier"/>
        <_config:mapping xpath="AttributeIdentifier/UniqueID" value="AttributeUniqueId"/>
        <_config:mapping xpath="AttributeDataType" value="Type" />
        <_config:mapping xpath="AttributeType" value="AttributeType" />
        <_config:mapping xpath="displaySequence" value="Sequence" />
        <_config:mapping xpath="displayable" value="Displayable" />
        <_config:mapping xpath="searchable" value="Searchable" />
        <_config:mapping xpath="facetable" value="Facetable" />
        <_config:mapping xpath="merchandisable" value="Merchandisable" />
        <_config:mapping xpath="comparable" value="Comparable" />
        <_config:mapping xpath="storeDisplay" value="StoreDisplay" />
        <_config:mapping xpath="ExtendedData/Field1" value="AttributeField1" />
        <_config:mapping xpath="ExtendedData/Field2" value="AttributeField2" />
        <_config:mapping xpath="ExtendedData/Field3" value="AttributeField3" />
        <!-- AttributeDescription -->
        <_config:mapping xpath="AttributeDescription[0]/language" value="Language" />
        <_config:mapping xpath="AttributeDescription[0]/language" value="LanguageId" />
        <_config:mapping xpath="AttributeDescription[0]/Name" value="Name" />
        <_config:mapping xpath="AttributeDescription[0]/Description" value="Description" />
        <_config:mapping xpath="AttributeDescription[0]/ExtendedData/SecondaryDescription" value="SecondaryDescription" />
        <_config:mapping xpath="AttributeDescription[0]/ExtendedData/DisplayGroupName" value="GroupName" />
		<_config:mapping xpath="AttributeDescription[0]/ExtendedData/DisplayGroupName" value="AssociatedKeyword" />
        <_config:mapping xpath="AttributeDescription[0]/ExtendedData/Field1" value="Field1" />
        <_config:mapping xpath="AttributeDescription[0]/ExtendedData/Footnote" value="Footnote" />
        <_config:mapping xpath="AttributeDescription[0]/ExtendedData/UnitOfMeasure" value="UnitOfMeasure" />
        <!-- AttributeDescription in French -->
        <_config:mapping xpath="AttributeDescription[1]/language" value="-2" valueFrom="Fixed" />
        <_config:mapping xpath="AttributeDescription[1]/Name" value="NameFrench" />
        <_config:mapping xpath="AttributeDescription[1]/Description" value="DescriptionFrench" />
        <_config:mapping xpath="AttributeDescription[1]/ExtendedData/SecondaryDescription" value="SecondaryDescriptionFrench" />
        <_config:mapping xpath="AttributeDescription[1]/ExtendedData/DisplayGroupName" value="GroupNameFrench" />
		<_config:mapping xpath="AttributeDescription[1]/ExtendedData/DisplayGroupName" value="AssociatedKeywordFrench" />
        <_config:mapping xpath="AttributeDescription[1]/ExtendedData/Field1" value="Field1French" />
        <_config:mapping xpath="AttributeDescription[1]/ExtendedData/Footnote" value="FootnoteFrench" />
        <_config:mapping xpath="AttributeDescription[1]/ExtendedData/UnitOfMeasure" value="UnitOfMeasureFrench" />
        <!-- AllowedValue -->
        <_config:mapping xpath="AllowedValue[0]/identifier" value="AllowedValue1" />
        <_config:mapping xpath="AllowedValue[0]/displaySequence" value="1.0" valueFrom="Fixed" />
        <_config:mapping xpath="AllowedValue[0]/Value" value="AllowedValue1" />
        <_config:mapping xpath="AllowedValue[0]/ExtendedValue/ValueUsage" value="1" valueFrom="Fixed" />
        <_config:mapping xpath="AllowedValue[1]/identifier" value="AllowedValue2" />
        <_config:mapping xpath="AllowedValue[1]/displaySequence" value="2.0" valueFrom="Fixed" />
        <_config:mapping xpath="AllowedValue[1]/Value" value="AllowedValue2" />
        <_config:mapping xpath="AllowedValue[1]/ExtendedValue/ValueUsage" value="1" valueFrom="Fixed" />
        <_config:mapping xpath="AllowedValue[2]/identifier" value="AllowedValue3" />
        <_config:mapping xpath="AllowedValue[2]/displaySequence" value="3.0" valueFrom="Fixed" />
        <_config:mapping xpath="AllowedValue[2]/Value" value="AllowedValue3" />
        <_config:mapping xpath="AllowedValue[2]/ExtendedValue/ValueUsage" value="1" valueFrom="Fixed" />
        <_config:mapping xpath="AllowedValue[3]/identifier" value="AllowedValue4" />
        <_config:mapping xpath="AllowedValue[3]/displaySequence" value="4.0" valueFrom="Fixed" />
        <_config:mapping xpath="AllowedValue[3]/Value" value="AllowedValue4" />
        <_config:mapping xpath="AllowedValue[3]/ExtendedValue/ValueUsage" value="1" valueFrom="Fixed" />
        <_config:mapping xpath="AllowedValue[4]/identifier" value="AllowedValue5" />
        <_config:mapping xpath="AllowedValue[4]/displaySequence" value="5.0" valueFrom="Fixed" />
        <_config:mapping xpath="AllowedValue[4]/Value" value="AllowedValue5" />
        <_config:mapping xpath="AllowedValue[4]/ExtendedValue/ValueUsage" value="1" valueFrom="Fixed" />
        <_config:mapping xpath="" value="Delete" deleteValue="1" />
      </_config:DataMapping>
      <_config:BusinessObjectMediator className="com.ibm.commerce.catalog.dataload.mediator.AttributeDictionaryAttributeMediator" componentId="com.ibm.commerce.catalog" >
		<_config:property name="allowChangeAttributeType" value="true" />
		<_config:property name="validateAttribute" value="true" />
      </_config:BusinessObjectMediator>
    </_config:BusinessObjectBuilder>

    <!--  Attribute Dictionary Attribute Search Index -->
    <_config:BusinessObjectBuilder className="com.ibm.commerce.foundation.dataload.businessobjectbuilder.BaseBusinessObjectBuilder"
      packageName="com.ibm.commerce.catalog.facade.datatypes.CatalogPackage" dataObjectType="AttributeDictionaryAttributeType" >

      <_config:DataMapping>
        <_config:mapping xpath="AttributeIdentifier/ExternalIdentifier/Identifier" value="Identifier" />
        <_config:mapping xpath="AttributeIdentifier/UniqueID" value="AttributeUniqueId" />
       
        <_config:mapping xpath="searchable" value="Searchable" />
        <_config:mapping xpath="merchandisable" value="Merchandisable" />
        <_config:mapping xpath="facetable" value="Facetable" />
      </_config:DataMapping>
      <_config:BusinessObjectMediator className="com.ibm.commerce.catalog.dataload.mediator.AttributeDictionaryAttributeSearchIndexMediator" componentId="com.ibm.commerce.catalog" >
      </_config:BusinessObjectMediator>
    </_config:BusinessObjectBuilder>

  </_config:DataLoader>

</_config:DataloadBusinessObjectConfiguration>







-- wc-loader-catalog-entry-AD-attribute-relationship.xml

<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
-->
<_config:DataloadBusinessObjectConfiguration 
	xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance"
	xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../../../../xml/config/xsd/wc-dataload-businessobject.xsd" 
	xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config">
  
  <_config:DataLoader className="com.ibm.commerce.foundation.dataload.BusinessObjectLoader" >
    <_config:DataReader className="com.ibm.commerce.foundation.dataload.datareader.CSVReader" firstLineIsHeader="true" useHeaderAsColumnName="true" >
        <_config:property name="keyColumns" value="PartNumber,AttributeIdentifier,ValueIdentifier" />
    </_config:DataReader>
    <_config:BusinessObjectBuilder className="com.ibm.commerce.foundation.dataload.businessobjectbuilder.BaseBusinessObjectBuilder"
      packageName="com.ibm.commerce.catalog.facade.datatypes.CatalogPackage" dataObjectType="CatalogEntryType" >
      <_config:DataMapping>
        <_config:mapping xpath="CatalogEntryIdentifier/ExternalIdentifier/PartNumber" value="PartNumber" />
        <_config:mapping xpath="CatalogEntryIdentifier/UniqueID" value="CatalogEntryUniqueId"/>
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/AttributeIdentifier/ExternalIdentifier/Identifier" value="AttributeIdentifier" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/AttributeIdentifier/UniqueID" value="AttributeUniqueId"/>
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/Value/identifier" value="ValueIdentifier" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/Value/value" value="Value" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/language" value="Language" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/language" value="LanguageId" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/usage" value="Usage" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/displaySequence" value="Sequence" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/ExtendedData/AttributeRelationshipField1" value="Field1" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/ExtendedData/AttributeRelationshipField2" value="Field2" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/ExtendedData/AttributeRelationshipField3" value="Field3" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/ExtendedValue/AttributeValueField1" value="AttributeValueField1" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/ExtendedValue/AttributeValueField2" value="AttributeValueField2" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/ExtendedValue/AttributeValueField3" value="AttributeValueField3" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/ExtendedValue/Field1" value="AttributeValueDescriptionField1" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/ExtendedValue/Field2" value="AttributeValueDescriptionField2" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/ExtendedValue/Field3" value="AttributeValueDescriptionField3" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/ExtendedValue/Image1" value="AttributeValueDescriptionImage1" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/ExtendedValue/Image2" value="AttributeValueDescriptionImage2" />
        <_config:mapping xpath="CatalogEntryAttributes/Attributes[0]/ExtendedValue/UnitOfMeasure" value="UnitOfMeasure" />
 
        <_config:mapping xpath="" value="Delete" deleteValue="1" />
      </_config:DataMapping>
      <_config:BusinessObjectMediator className="com.ibm.commerce.catalog.dataload.mediator.CatalogEntryAttributeDictionaryAttributeMediator" componentId="com.ibm.commerce.catalog" >
      	<_config:property name="supportMultipleValuesForADAttributes" value="true" />
      	<_config:property name="attributeValueValidation" value="true" />
      	<_config:property name="shareAssignedAttributeValues" value="false" />
	<_config:property name="resolveAndAssociateVariantItems" value="false" />
      </_config:BusinessObjectMediator>
    </_config:BusinessObjectBuilder>
  </_config:DataLoader>

</_config:DataloadBusinessObjectConfiguration>





-- SQL command for checking attr tables
select * from attr where IDENTIFIER='Size';
select * from attr where IDENTIFIER='Brand';
select * from catentryattr where ATTR_ID=7000000000000000014 and CATENTRY_ID=12623;
select * from attr where identifier in ('GiftWrappable');
select * from attrval where attr_id in (select attr_id from attr where identifier in
 ('GiftWrappable'));
 select * from attrvaldesc where ATTRVAL_ID in (7000000000000005502, 7000000000000005501);
 select attr_id,attrval_id,identifier from attrval where attrval_id in (select attrval_id from catentryattr
 where catentry_id in (select catentry_id from catentry where partnumber like 'CAC024_240101'));
select * from CATENTRYATTR where ATTR_ID=7000000000000001001;






Part 1 Step 5

-- ShopperActions_UI.jspf where we added Gift Wrap service UI

<%--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
--%>
<%-- START ShopperActions_UI.jspf --%>

<c:if test="${!empty catalogEntryID}">
	<div class="shopperActions">
				
				<%-- START : DISPLAY ADD 2 CART button or Unavailable --%>
				<c:choose>
					<c:when test="${productAvailable eq 'true'}">
						<div class="quantity_section">
							<label for="quantity_<c:out value='${catalogEntryID}'/>" class="header"><wcst:message key="PD_QTY" bundle="${widgetText}"/></label>
							<input name="quantity_<c:out value='${catalogEntryID}'/>" id="quantity_<c:out value='${catalogEntryID}'/>" type="tel" class="quantity_input" value="1" onchange="javascript:productDisplayJS.notifyQuantityChange(this.value);">
							<div class="clear_float"></div>
						</div>
					
						<div class="clear_float"></div>
						<div class="item_spacer_10px"></div>
						
						<%-- APPLEPAY BEGIN --%>
						<flow:ifEnabled feature="ApplePay">
							<a class="apple-pay-button left apple-pay-pdp" id="applePayButtonDiv" wairole="button" role="button" aria-label="<wcst:message key="APPLE_PAY_BUTTON" bundle="${widgetText}"/>" onclick="javascript: applePayButtonClicked('entitledItem_<c:out value='${catalogEntryID}'/>', document.getElementById('quantity_<c:out value='${catalogEntryID}'/>').value);" href="javascript:void(0);"></a>
							<div class="apple-pay-button-clear-float"></div>
							<div class="clear_float"></div>
							<div class="item_spacer_8px"></div>
						</flow:ifEnabled>
						<%-- APPLEPAY END --%>
						
						<%-- START: CUSTOMVIEW ADDING UI FOR GIFT SERVICE --%>
						<c:if test="${not empty descAttrMap}">
							<c:forEach var="descriptiveAttr" items="${descAttrMap}" varStatus="status">
								<c:set var="descAttrName" value="${descAttrNames[descriptiveAttr.key]}"/>
								<c:if test="${descAttrName == 'Gift Wrappable' }">
								
									<%-- START: CUSTOMVIEW GET GIFT MESSAGE FROM GIFT MESSAGE TEXT AREA --%>
									<div>
										<span>Gift wrap</span> <input type="checkbox" id="giftServiceCheckboxInput"> 
										<br>
									</div>
									<div id="giftServiceMessageSection" style="display:none">
										<span>Gift Message:</span> 
										<br />
										<textarea id="giftServiceMessageTextInput"></textarea>
									</div>
									<script type="text/javascript">
										$(document).ready(function() {
											$("#giftServiceCheckboxInput").change(function() {
												if(this.checked) {
													$("#giftServiceMessageSection").show();
												} else {
													$("#giftServiceMessageTextInput").val("");
													$("#giftServiceMessageSection").hide();
												}
											})
										})						
									</script>
									<%-- END: CUSTOMVIEW GET GIFT MESSAGE FROM GIFT MESSAGE TEXT AREA --%>
								</c:if>
							</c:forEach>
						</c:if>
						<%-- END: CUSTOMVIEW ADDING UI FOR GIFT SERVICE --%>
						<a id="add2CartBtn" href="javascript:setCurrentId('add2CartBtn');var giftMessage = '';var giftMessageInputVal=document.getElementById('giftServiceMessageTextInput');if(giftMessageInputVal !== null) giftMessage=giftMessageInputVal.value;productDisplayJS.Add2ShopCartAjax('entitledItem_<c:out value='${catalogEntryID}'/>',document.getElementById('quantity_<c:out value='${catalogEntryID}'/>').value, false, {'attributeName': 'GIFT_MESSAGE', 'attributeValue': giftMessage})" wairole="button" role="button" class="button primary"
							title="<wcst:message key="PD_ADD_TO_CART" bundle="${widgetText}"/>" onKeyPress="javascript:MessageHelper.setFocusElement('add2CartBtn');">
							<div class="left_border"></div>
							<div id="productPageAdd2Cart" class="button_text">
								<wcst:message key="PD_ADD_TO_CART" bundle="${widgetText}"/>
							</div>
							<div class="right_border"></div>
						</a>
					</c:when>
					<c:when test="${bundleKitAvailable eq 'true'}">
						<c:choose>
							<%-- package --%>
							<c:when test="${type eq 'package'}">
								<div class="product_quantity_addtolist">					
									<div class="quantity_section">
										<label for="packageQty" class="header"><wcst:message key="PKG_QUANTITY" bundle="${widgetText}"/></label>
										<input id="packageQty" type="tel" class="quantity_input" value="1" onchange="javascript:productDisplayJS.notifyQuantityChange(this.value);"/>
										<div class="clear_float"></div>
									</div>
			
									<div class="clear_float"></div>
								</div>
								
								<%-- APPLEPAY BEGIN --%>
								<flow:ifEnabled feature="ApplePay">
									<div class="clear_float"></div>
									<div class="item_spacer_10px"></div>
									<a class="apple-pay-button button left apple-pay-pdp" id="applePayButtonDiv" wairole="button" role="button" aria-label="<wcst:message key="APPLE_PAY_BUTTON" bundle="${widgetText}"/>" onclick="javascript: applePayButtonClicked(null, document.getElementById('packageQty').value, '${catalogEntryID}');" href="javascript:void(0);"></a>
									<div class="apple-pay-button-clear-float"></div>
								</flow:ifEnabled>
								<%-- APPLEPAY END --%>

								<div class="item_spacer_8px"></div>
							
								<a id="addToCartBtn" href="javascript:setCurrentId('addToCartBtn');shoppingActionsJS.AddItem2ShopCartAjax('${catalogEntryID}',$('#packageQty').val());" wairole="button" role="button" class="button primary"
									title="<wcst:message key="PKG_ADD_TO_CART" bundle="${widgetText}"/>">
									<div class="left_border"></div>
									<div id="productPageAdd2Cart" class="button_text">
										<wcst:message key="PKG_ADD_TO_CART" bundle="${widgetText}"/>
									</div>
									<div class="right_border"></div>
								</a>
							</c:when>
							
							<%-- bundle --%>
							<c:when test="${type eq 'bundle'}">
								<%-- APPLEPAY BEGIN --%>
								<flow:ifEnabled feature="ApplePay">
									<div class="clear_float"></div>
									<div class="item_spacer_10px"></div>
									<a class="apple-pay-button button left apple-pay-pdp" id="applePayButtonDiv" wairole="button" role="button" aria-label="<wcst:message key="APPLE_PAY_BUTTON" bundle="${widgetText}"/>" onclick="javascript: applePayButtonClicked(null, null, null, 'bundle');" href="javascript:void(0);"></a>
									<div class="apple-pay-button-clear-float"></div>
								</flow:ifEnabled>
								<%-- APPLEPAY END --%>

								<div class="item_spacer_8px"></div>
							
								<a id="addToCartBtn" href="javascript:setCurrentId('addToCartBtn');shoppingActionsJS.AddBundle2ShopCartAjax();" class="button primary" wairole="button" role="button" 
									title="<wcst:message key="PD_ADD_TO_CART" bundle="${widgetText}"/>">
									<div class="left_border"></div>
									<div id="productPageAdd2Cart" class="button_text">
										<wcst:message key="PD_ADD_TO_CART" bundle="${widgetText}"/>
									</div>
									<div class="right_border"></div>
								</a>
							</c:when>
							<c:otherwise>
							</c:otherwise>
						</c:choose>
					</c:when>
					<c:when test="${dynamicKitAvailable eq 'true'}">
						<c:choose>
							<c:when test="${type == 'dynamickit' or type == 'preddynakit'}">
								<%-- Define the style class for Customize button --%>
								<c:choose>
									<c:when test="${isDKConfigurable}">
										<c:set var="customizeBtnStyle" value="button primary"/>
									</c:when>
									<c:otherwise>
										<c:set var="customizeBtnStyle" value="button secondary"/>
									</c:otherwise>
								</c:choose>	
								
								<c:if test="${(isDKConfigurable) || isDKPreConfigured}">
									<div>
										<label for="quantity_<c:out value='${catalogEntryID}'/>" class="header"><wcst:message key="PD_QTY" bundle="${widgetText}"/></label>
										<input name="quantity_<c:out value='${catalogEntryID}'/>" id="quantity_<c:out value='${catalogEntryID}'/>" type="tel" class="quantity_input" value="1" onchange="javascript:shoppingActionsJS.notifyQuantityChange(this.value);">
										<div class="clear_float"></div>
									</div>
								</c:if>
								
								<div class="clear_float"></div>
								<div class="item_spacer_10px"></div>
								
								<%-- START : DISPLAY ADD 2 CART button or Unavailable --%>
								<c:choose>
									<c:when test="${requestScope.dynamicKitAvailable eq 'true'}">
										<c:if test="${isDKPreConfigured}">
											<a id="add2CartBtn" href="javascript:setCurrentId('add2CartBtn');shoppingActionsJS.Add2ShopCartAjax('entitledItem_<c:out value='${catalogEntryID}'/>',document.getElementById('quantity_<c:out value='${catalogEntryID}'/>').value, false, {catalogEntryType: 'dynamicKit'});" class="button primary" wairole="button" role="button" title="<wcst:message key="PD_ADD_TO_CART" bundle="${widgetText}"/>">
												<div class="left_border"></div>
												<div id="productPageAdd2Cart" class="button_text">
													<wcst:message key="PD_ADD_TO_CART" bundle="${widgetText}"/>
												</div>
												<div class="right_border"></div>
											</a>
											
											<div class="clear_float"></div>
											<div class="item_spacer_8px"></div>
										</c:if>			
										<c:if test="${isDKConfigurable && dynamicKitConfigurable}">
											<a id="customizeBtn" href="javascript:setCurrentId('customizeBtn');
											categoryDisplayJS.setCommonParameters('<c:out value="${WCParam.langId}"/>','<c:out value="${WCParam.storeId}"/>','<c:out value="${WCParam.catalogId}"/>', '${userType}');
											categoryDisplayJS.ConfigureDynamicKit(<c:out value='${catalogEntryID}'/>,document.getElementById('quantity_<c:out value='${catalogEntryID}'/>').value, {catalogEntryType: 'dynamicKit'} );"
											 class="${customizeBtnStyle}" title="<wcst:message key="CUSTOMIZE" bundle="${widgetText}"/>">
												<div class="left_border"></div>
												<div class="button_text">
													<c:choose>
														<c:when test="${isDKPreConfigured}">
															<wcst:message key="RECONFIGURE" bundle="${widgetText}"/>
														</c:when>
														<c:otherwise>
															<wcst:message key="CUSTOMIZE" bundle="${widgetText}"/>
														</c:otherwise>
													</c:choose>
												</div>
												<div class="right_border"></div>
											</a>
											
										<div class="clear_float"></div>
											<div class="item_spacer_2px"></div>
										</c:if>
										
										
									</c:when>
									<c:otherwise>									
									</c:otherwise>
								</c:choose>	
							</c:when>	
						</c:choose>					
					</c:when>
					<c:otherwise>
						<div class="item_spacer_10px"></div>
						<div class="item_spacer_5px"></div>
						<div class="disabled">
							<div id="add2CartBtn" class="button primary">
								<div class="left_border"></div>
								<div class="button_text"><wcst:message key="PD_UNAVAILABLE" bundle="${widgetText}"/></div>
								<div class="right_border"></div>
							</div>																	
						</div>
					</c:otherwise>
				</c:choose>	
				<%-- END : DISPLAY ADD 2 CART button or Unavailable --%>

				<div class="clear_float"></div>
				<div class="item_spacer_8px"></div>
				
				<%--START : DISPLAY Wish List button --%>
				<%out.flush();%>
					<c:import url="${env_siteWidgetsDir}Common/ShoppingList/ShoppingList.jsp" />
				<%out.flush();%>
				
	</div>
			<div class="clear_float"></div>
			<div class="item_spacer_7px"></div>			

			<%--END : DISPLAY Wish List button --%>
</c:if>

<%-- END ShopperActions_UI.jspf --%>






Part 1 Step 6

-- OrderItemDetailSummary.jsp where we added custom ui for displaying gift wrapped value and gift message

<%--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
--%>

<%--
Displays the order details for Single Shipment on the Order Summary page
as well as Order Confirmation page
--%>

<!-- BEGIN OrderItemDetailSummary.jsp -->
<%@ taglib uri="http://java.sun.com/jsp/jstl/fmt" prefix="fmt" %>
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ taglib uri="http://commerce.ibm.com/base" prefix="wcbase" %>
<%@ taglib uri="http://commerce.ibm.com/foundation" prefix="wcf" %>
<%@ taglib uri="flow.tld" prefix="flow" %>
<%@ include file="../../../Common/EnvironmentSetup.jspf"%>
<%@ include file="../../../Common/nocache.jspf" %>
<%@ taglib prefix="fn" uri="http://java.sun.com/jsp/jstl/functions" %>

<%-- Substring to search for --%>
 <c:set var="search" value='"'/>
<%-- Substring to replace the search string with --%>
 <c:set var="replaceStr" value="'"/>

<c:set var="pageSize" value="${WCParam.pageSize}" />
<c:if test="${empty pageSize}">
	<c:set var="pageSize" value="${maxOrderItemsPerPage}"/>
</c:if>
<fmt:parseNumber var="pageSize" value="${pageSize}"/>

<%-- Index to begin the order item paging with --%>
<c:set var="beginIndex" value="${WCParam.beginIndex}" />
<c:if test="${empty beginIndex}">
	<c:set var="beginIndex" value="0" />
</c:if>

<fmt:formatNumber var="currentPage" value="${(beginIndex/pageSize)+1}"/>
<fmt:parseNumber var="currentPage" value="${currentPage}" integerOnly="true"/>

<%-- To identify which order page we're currently in --%>
<c:set var="orderPage" value="${param.orderPage}" />
<c:if test="${empty orderPage}">
	<c:set var="orderPage" value="${WCParam.orderPage}" />
</c:if>

<%-- To identify if this JSP is imported from the Order Details page --%>
<c:set var="isFromOrderDetailsPage" value="false"/>
<c:if test="${(!empty param.isFromOrderDetailsPage) && (param.isFromOrderDetailsPage == 'true')}">
	<c:set var="isFromOrderDetailsPage" value="true"/>
</c:if>

<c:set var="subscriptionOrderItemId" value="${param.subscriptionOrderItemId}" />

<%@ include file="../../../Snippets/ReusableObjects/GiftItemInfoDetailsDisplayExt.jspf" %>
<%@ include file="../../../Snippets/ReusableObjects/GiftRegistryGiftItemInfoDetailsDisplayExt.jspf" %>

<%-- Retrieve the current page of order & order item information from this request --%>
<c:set var="pagorder" value="${requestScope.order}"/>
<c:if test="${empty pagorder || pagorder == null}">
<c:choose>
<c:when test="${WCParam.externalOrderId != null && WCParam.externalOrderId != ''}">
<wcf:rest var="pagorder" url="store/{storeId}/order/{orderId}" scope="request">
	<wcf:var name="storeId" value="${WCParam.storeId}" encode="true"/>
	<wcf:var name="orderId" value="${WCParam.externalOrderId}" encode="true"/>
	<wcf:param name="pageSize" value="${pageSize}"/>
	<wcf:param name="pageNumber" value="${currentPage}"/>
	<wcf:param name="sortOrderItemBy" value="orderItemID"/>
</wcf:rest>
</c:when>
<c:when test="${WCParam.externalQuoteId != null && WCParam.externalQuoteId != ''}">
<wcf:rest var="quote" url="store/{storeId}/order" scope="request">
	<wcf:var name="storeId" value="${WCParam.storeId}" encode="true"/>
	<wcf:param name="q" value="findQuoteByExternalQuoteId"/>
	<wcf:param name="quoteId" value="${WCParam.externalQuoteId}"/>
	<wcf:param name="pageSize" value="${pageSize}"/>
	<wcf:param name="pageNumber" value="${currentPage}"/>
</wcf:rest>
<c:set var="pagorder" value="${quote.orderTemplate}" scope="request"/>
</c:when>
<c:otherwise>
	<c:choose>
		<c:when test="${orderPage == 'confirmation'}">
			<wcf:rest var="pagorder" url="store/{storeId}/order/{orderId}">
				<wcf:var name="storeId" value="${WCParam.storeId}" encode="true"/>
				<wcf:var name="orderId" value="${WCParam.orderId}" encode="true"/>
				<wcf:param name="accessProfile" value="IBM_Details" />
				<wcf:param name="pageSize" value="${pageSize}"/>
				<wcf:param name="pageNumber" value="${currentPage}"/>
				<wcf:param name="sortOrderItemBy" value="orderItemID"/>
			</wcf:rest>
		</c:when>
		<c:otherwise>
			<wcf:rest var="pagorder" url="store/{storeId}/cart/@self">
				<wcf:var name="storeId" value="${WCParam.storeId}" encode="true"/>
				<wcf:param name="accessProfile" value="IBM_Details" />
				<wcf:param name="pageSize" value="${pageSize}"/>
				<wcf:param name="pageNumber" value="${currentPage}"/>
				<wcf:param name="sortOrderItemBy" value="orderItemID"/>
				<wcf:param name="langId" value="${langId}" />
			</wcf:rest>
		</c:otherwise>
	</c:choose>
</c:otherwise>
</c:choose>
</c:if>

<fmt:parseNumber var="recordSetTotal" value="${pagorder.recordSetTotal}" integerOnly="true" />

<c:if test="${beginIndex == 0}">
	<c:if test="${recordSetTotal > pagorder.recordSetCount}">
		<c:set var="pageSize" value="${pagorder.recordSetCount}" />
	</c:if>
</c:if>

<c:set var="numEntries" value="${recordSetTotal}"/>

<wcf:url var="currentOrderItemDetailPaging" value="OrderItemPageView" type="Ajax">
	<wcf:param name="storeId" value="${storeId}"  />
	<wcf:param name="catalogId" value="${WCParam.catalogId}"/>
	<wcf:param name="langId" value="${WCParam.langId}" />
	<wcf:param name="orderPage" value="${orderPage}" />
	<c:if test="${orderPage == 'confirmation'}">
		<wcf:param name="orderId" value="${WCParam.orderId}" />
	</c:if>
</wcf:url>

<c:set var="orderStatus" value="${pagorder.orderStatus}"/>
<c:set var="isOrderScheduled" value="false"/>
<c:if test="${!empty requestScope.isOrderScheduled}">
	<c:set var="isOrderScheduled" value="${requestScope.isOrderScheduled}"/>
</c:if>

<c:if test="${empty subscriptionOrderItemId}">
	<c:if test="${numEntries > pageSize}">
		<fmt:formatNumber var="totalPages" value="${(numEntries/pageSize)}" maxFractionDigits="0"/>
		<c:if test="${numEntries%pageSize < (pageSize/2)}">
			<fmt:formatNumber var="totalPages" value="${(numEntries+(pageSize/2)-1)/pageSize}" maxFractionDigits="0"/>
		</c:if>
		<fmt:parseNumber var="totalPages" value="${totalPages}" integerOnly="true"/>

		<c:choose>
			<c:when test="${beginIndex + pageSize >= numEntries}">
				<c:set var="endIndex" value="${numEntries}" />
			</c:when>
			<c:otherwise>
				<c:set var="endIndex" value="${beginIndex + pageSize}" />
			</c:otherwise>
		</c:choose>

		<fmt:formatNumber var="currentPage" value="${(beginIndex/pageSize)+1}"/>
		<fmt:parseNumber var="currentPage" value="${currentPage}" integerOnly="true"/>


		<div class="shopcart_pagination" id="OrderItemDetailSummaryPagination1">
			<br/><br/>
			<span class="text">
				<fmt:message bundle="${storeText}" key="CATEGORY_RESULTS_DISPLAYING">
					<fmt:param><fmt:formatNumber value="${beginIndex + 1}"/></fmt:param>
					<fmt:param><fmt:formatNumber value="${endIndex}"/></fmt:param>
					<fmt:param><fmt:formatNumber value="${numEntries}"/></fmt:param>
				</fmt:message>
				<span class="paging">
					<c:if test="${beginIndex != 0}">
						<a id="OrderItemDetailSummaryPg1_1" class="tlignore" href="javaScript:setCurrentId('OrderItemDetailSummaryPg1_1'); if(submitRequest()){ cursor_wait();
						wcRenderContext.updateRenderContext('OrderItemPaginationDisplay_Context',{'beginIndex':'<c:out value='${beginIndex - pageSize}'/>','pageSize':'<c:out value='${pageSize}'/>','externalOrderId':'${WCParam.externalOrderId}','externalQuoteId':'${WCParam.externalQuoteId}','isFromOrderDetailsPage':'<c:out value='${isFromOrderDetailsPage}'/>'});}">
					</c:if>
					<img src="<c:out value="${jspStoreImgDir}${env_vfileColor}${vfileColorBIDI}" />paging_back.png" alt="<fmt:message bundle="${storeText}" key="CATEGORY_PAGING_LEFT_IMAGE"/>" />
					<c:if test="${beginIndex != 0}">
						</a>
					</c:if>
					<fmt:message bundle="${storeText}" key="CATEGORY_RESULTS_PAGES_DISPLAYING">
						<fmt:param><fmt:formatNumber value="${currentPage}"/></fmt:param>
						<fmt:param><fmt:formatNumber value="${totalPages}"/></fmt:param>
					</fmt:message>
					<c:if test="${numEntries > endIndex }">
						<a id="OrderItemDetailSummaryPg1_2" class="tlignore" href="javaScript:setCurrentId('OrderItemDetailSummaryPg1_2'); if(submitRequest()){ cursor_wait();
						wcRenderContext.updateRenderContext('OrderItemPaginationDisplay_Context',{'beginIndex':'<c:out value='${beginIndex + pageSize}'/>','pageSize':'<c:out value='${pageSize}'/>','externalOrderId':'${WCParam.externalOrderId}','externalQuoteId':'${WCParam.externalQuoteId}','isFromOrderDetailsPage':'<c:out value='${isFromOrderDetailsPage}'/>'});}">
					</c:if>
					<img src="<c:out value="${jspStoreImgDir}${env_vfileColor}${vfileColorBIDI}" />paging_next.png" alt="<fmt:message bundle="${storeText}" key="CATEGORY_PAGING_RIGHT_IMAGE"/>" />
					<c:if test="${numEntries > endIndex }">
						</a>
					</c:if>
				</span>
			</span>
		</div>
	</c:if>
</c:if>

 <table id="order_details" cellpadding="0" cellspacing="0" border="0" width="100%" summary="<fmt:message bundle="${storeText}" key="SHOPCART_TABLE_CONFIRM_SUMMARY"/>">

	<tr class="nested">
		<th class="align_left" id="SingleShipment_tableCell_productName"><fmt:message bundle="${storeText}" key="PRODUCT"/></th>
		<c:set var="th_count" value="1"/>
		<c:if test="${isFromOrderDetailsPage && !(orderStatus eq 'I')}">
			<flow:ifEnabled feature="FutureOrders">
				<th class="align_left requestedShippingDate" id="SingleShipment_tableCell_requestedShippingDate"><fmt:message bundle="${storeText}" key="SHIP_REQUESTED_DATE"/></th>
				<c:set var="th_count" value="${th_count + 1}"/>
			</flow:ifEnabled>
		</c:if>
		<flow:ifEnabled feature="ExpeditedOrders">
			<c:if test="${orderStatus != 'I' && !isOrderScheduled}">
				<%-- Missing message --%>
				<th class="expedite" id="SingleShipment_tableCell_expedite"><fmt:message bundle="${storeText}" key="SHIP_EXPEDITE_SHIPPING"/></th>
				<c:set var="th_count" value="${th_count + 1}"/>
			</c:if>
		</flow:ifEnabled>

		<c:remove var="isSBSEnabled"/>
		<flow:ifEnabled feature="SideBySideIntegration">
			<c:set var="isSBSEnabled">Y</c:set>
			<c:choose>
				<c:when test="${orderPage == 'confirmation' && isFromOrderDetailsPage=='true'}">
					<th class="avail" id="SingleShipment_tableCell_availability"><fmt:message bundle="${storeText}" key="MO_SUBSCRIPTION_STATUS"/></th>
				</c:when>
				<c:otherwise>
					<th class="avail" id="SingleShipment_tableCell_availability"><fmt:message bundle="${storeText}" key="AVAILABILITY"/></th>
				</c:otherwise>
			</c:choose>
			<c:set var="th_count" value="${th_count + 1}"/>
		</flow:ifEnabled>
		<flow:ifDisabled feature="SideBySideIntegration">
			<c:set var="isSBSEnabled">N</c:set>
			<th class="avail" id="SingleShipment_tableCell_availability"><fmt:message bundle="${storeText}" key="AVAILABILITY"/></th>
			<c:set var="th_count" value="${th_count + 1}"/>
		</flow:ifDisabled>
		<th class="QTY" id="SingleShipment_tableCell_quantity" abbr="<fmt:message bundle="${storeText}" key="QUANTITY1"/>"><fmt:message bundle="${storeText}" key="QTY"/></th>
		<c:set var="th_count" value="${th_count + 1}"/>
		<th class="each short" id="SingleShipment_tableCell_unitPrice" abbr="<fmt:message bundle="${storeText}" key="UNIT_PRICE"/>"><fmt:message bundle="${storeText}" key="EACH"/></th>
		<c:set var="th_count" value="${th_count + 1}"/>
		<th class="total short" id="SingleShipment_tableCell_totalPrice" abbr="<fmt:message bundle="${storeText}" key="TOTAL_PRICE"/>"><fmt:message bundle="${storeText}" key="TOTAL"/></th>
	</tr>

	<c:if test="${!empty pagorder.orderItem}">
		<%--
			The following snippet retrieves all the catalog entries associated with each item in the current order.
			It was taken out of the larger c:forEach loop below for performance reasons.
		--%>
		<jsp:useBean id="itemDetailsInThisOrder" class="java.util.HashMap" scope="page"/>

		<c:catch var="searchServerException">
			<wcf:rest var="allCatEntryInOrder" url="${searchHostNamePath}${searchContextPath}/store/${WCParam.storeId}/productview/byIds" >
				<c:forEach var="orderItem0" items="${pagorder.orderItem}">
					<%@ include file="../../../Snippets/Catalog/CatalogEntryDisplay/ResolveCatalogEntryIDExt.jspf" %>
					<wcf:param name="id" value="${orderItem0.productId}"/>
				</c:forEach>
				<wcf:param name="langId" value="${langId}" />
				<wcf:param name="currency" value="${env_currencyCode}" />
				<wcf:param name="responseFormat" value="json" />
				<wcf:param name="catalogId" value="${sdb.masterCatalog.catalogId}" />
				<wcf:param name="profileName" value="IBM_findProductByIds_Summary_WithNoEntitlementCheck" />
			</wcf:rest>
		</c:catch>
		<c:forEach var="aCatEntry" items="${allCatEntryInOrder.catalogEntryView}">
			<c:set property="${aCatEntry.uniqueID}" value="${aCatEntry}" target="${itemDetailsInThisOrder}"/>
		</c:forEach>

		<c:if test="${showDynamicKit eq 'true'}">
			<c:set var="orderHasDKComponents" value="false" />
			<c:forEach var="orderItem" items="${pagorder.orderItem}">
				<c:if test="${!empty orderItem.orderItemComponent}">
					<c:set var="orderHasDKComponents" value="true" />
				</c:if>
			</c:forEach>
			<c:if test="${orderHasDKComponents eq 'true'}">
            	<c:catch var="searchServerException">
					<wcf:rest var="dkComponents" url="${searchHostNamePath}${searchContextPath}/store/${WCParam.storeId}/productview/byIds" >
						<c:forEach var="orderItem" items="${pagorder.orderItem}">
							<wcf:param name="id" value="${orderItem.productId}"/>
							<c:forEach var="orderItemComponents" items="${orderItem.orderItemComponent}">
								<wcf:param name="id" value="${orderItemComponents.catalogEntryIdentifier.uniqueID}"/>
							</c:forEach>
						</c:forEach>
						<wcf:param name="langId" value="${langId}" />
						<wcf:param name="currency" value="${env_currencyCode}" />
						<wcf:param name="responseFormat" value="json" />
						<wcf:param name="catalogId" value="${sdb.masterCatalog.catalogId}" />
					</wcf:rest>
                </c:catch>
			</c:if>
		</c:if>
	</c:if>

	<c:forEach var="orderItem" items="${pagorder.orderItem}" varStatus="status">
		<c:if test="${empty subscriptionOrderItemId || (!empty subscriptionOrderItemId && subscriptionOrderItemId == orderItem.orderItemId)}">
			<c:set var="catEntry" value="${itemDetailsInThisOrder[orderItem.productId]}"/>
			<c:if test="${catEntry.partNumber != null && !empty catEntry.partNumber && empty catEntry.parentCatalogEntryID}">
				<c:choose>
					<c:when test="${empty order_partnumbers}" >
						<c:set var="order_partnumbers" value="${catEntry.partNumber}" />
					</c:when>
					<c:otherwise>
						<c:set var="order_partnumbers" value="${order_partnumbers}|${catEntry.partNumber}" />
					</c:otherwise>
				</c:choose>
			</c:if>
			<c:if test="${not empty catEntry.parentCatalogEntryID}">
				<c:choose>
					<c:when test="${empty parentCatalogEntryIDs}" >
						<c:set var="parentCatalogEntryIDs" value="${catEntry.parentCatalogEntryID}" />
					</c:when>
					<c:otherwise>
						<c:set var="parentCatalogEntryIDs" value="${parentCatalogEntryIDs},${catEntry.parentCatalogEntryID}" />
					</c:otherwise>
				</c:choose>
			</c:if>
			<c:if test="${!empty catEntry.thumbnail}">
				<c:choose>
					<c:when test="${(fn:startsWith(catEntry.thumbnail, 'http://') || fn:startsWith(catEntry.thumbnail, 'https://'))}">
						<wcst:resolveContentURL var="thumbNail" url="${catEntry.thumbnail}"/>
					</c:when>
					<c:when test="${fn:startsWith(catEntry.thumbnail, '/store/0/storeAsset')}">
						<c:set var="thumbNail" value="${restPrefix}${catEntry.thumbnail}" />
					</c:when>
					<c:otherwise>
						<c:set var="thumbNail" value="${catEntry.thumbnail}" />
					</c:otherwise>
				</c:choose>
			</c:if>

		<!-- get the formatted qty for this item -->
		<fmt:formatNumber	var="quickCartOrderItemQuantity" value="${orderItem.quantity}" type="number" maxFractionDigits="0"/>
		<c:forEach var="discounts" items="${orderItem.adjustment}">
			<c:if test="${discounts.displayLevel == 'OrderItem'}">
				<c:set var="nobottom" value="th_align_left_no_bottom"/>
			</c:if>
		</c:forEach>

		<tr>
			<th class="th_align_left_normal ${fn:escapeXml(nobottom)}" id="SingleShipment_rowHeader_product${fn:escapeXml(status.count)}" abbr="<fmt:message bundle="${storeText}" key="Checkout_ACCE_for"/> <c:out value='${catEntry.name}' escapeXml='${env_escapeXmlFlag}'/>">
				<div class="img" id="WC_OrderItemDetailsSummaryf_div_1_${fn:escapeXml(status.count)}">
					<c:choose>
						<c:when test="${!empty thumbNail}">
							<img src="${fn:escapeXml(thumbNail)}" alt="${fn:escapeXml(catEntry.name)}" />
						</c:when>
						<c:otherwise>
							<img src="${fn:escapeXml(jspStoreImgDir)}images/NoImageIcon_sm.jpg" alt="${fn:escapeXml(catEntry.name)}" />
						</c:otherwise>
					</c:choose>
					<c:remove var="thumbNail"/>
				</div>
				<div class="itemspecs" id="WC_OrderItemDetailsSummaryf_div_2_${fn:escapeXml(status.count)}">
					<p class="strong_content"><c:out value="${catEntry.name}"/></p>
					<span><fmt:message bundle="${storeText}" key="CurrentOrder_SKU_COLON">
							<fmt:param><c:out value="${catEntry.partNumber}"/></fmt:param>
						</fmt:message>
					</span>
					<br />
					<%-- START: CUSTOMVIEW SHOW IF GIFTWRAPPED AND THE MESSAGE --%>
						<c:if test="${!empty  orderItem.orderItemExtendAttribute}">
							<c:if test="${orderItem.orderItemExtendAttribute[0].attributeName == 'GIFT_MESSAGE' }">
								<span>Gift wrapped: Yes</span><br/>
								<span>Gift Message: <c:out value="${orderItem.orderItemExtendAttribute[0].attributeValue}" /></span><br/>
							</c:if>
						</c:if>
					<%-- END: CUSTOMVIEW SHOW IF GIFTWRAPPED AND THE MESSAGE --%>
					<c:if test="${empty subscriptionOrderItemId}">
						<%--
						 ***
						 * Start: Display Defining attributes
						 * Loop through the attribute values and display the defining attributes
						 ***
						--%>
						<c:forEach var="attribute" items="${catEntry.attributes}">
							<c:set var="displayValue" value="${attribute.values[0].value}" />
							<c:if test="${ attribute.usage=='Defining' }" >
								<c:if test="${attribute.identifier != env_subsFulfillmentFrequencyAttrName
											&& attribute.identifier != env_subsPaymentFrequencyAttrName
											&& attribute.identifier != env_subsTimePeriodAttrName}">
									<span class="strongtext"><c:out value="${attribute.name}"/> : </span>
									<c:choose>
										<c:when test="${!empty displayValue}">
											<c:out value="${displayValue}"/>
										</c:when>
										<c:otherwise>
											<fmt:message bundle="${storeText}" key="MO_NOT_AVAILABLE"/>
										</c:otherwise>
									</c:choose>
									<br />
								</c:if>
							</c:if>
						</c:forEach>
						<%--
						 ***
						 * End: Display Defining attributes
						 ***
						--%>
					</c:if>

					<c:if test="${showDynamicKit eq 'true' && !empty orderItem.orderItemComponent}">
						<div class="top_margin5px"><fmt:message bundle="${storeText}" key="CONFIGURATION"/></div>
						<p>
							<ul class="product_specs" id="configuredComponents_${orderItem.orderItemId}">
								<c:forEach var="oiComponent" items="${orderItem.orderItemComponent}">
									<c:forEach var="savedDKComponent" items="${dkComponents.catalogEntryView}">
										<c:if test="${savedDKComponent.uniqueID == oiComponent.catalogEntryIdentifier.uniqueID}">
											<fmt:formatNumber var="itemComponentQuantity" value="${oiComponent.quantity.value}" type="number" maxFractionDigits="0"/>

											<c:choose>
												<c:when test="${itemComponentQuantity>1}">
													<%-- output order item component quantity in the form of "5 x ComponentName" --%>
													<fmt:message bundle="${storeText}" var="txtOrderItemQuantityAndName" key="ITEM_COMPONENT_QUANTITY_NAME" >
														<fmt:param><c:out value="${itemComponentQuantity}" escapeXml="false"/></fmt:param>
														<fmt:param><c:out value="${savedDKComponent.name}" escapeXml="false"/></fmt:param>
													</fmt:message>
													<li><c:out value="${txtOrderItemQuantityAndName}"/></li>
												</c:when>
												<c:otherwise>
													<li><c:out value="${savedDKComponent.name}"/></li>
												</c:otherwise>
											</c:choose>
										</c:if>
									</c:forEach>
								</c:forEach>
							</ul>
						</p>
					</c:if>

					<c:if test="${env_contractSelection}">
						<c:set var="isShoppingCartPage" value="false"/>
						<%@ include file="../../../Snippets/Order/Cart/B2BContractSelectExt.jspf" %>
					</c:if>
					<br />
					<%@ include file="../../../Snippets/ReusableObjects/OrderGiftItemDisplayExt.jspf" %>
					<%@ include file="../../../Snippets/ReusableObjects/GiftRegistryOrderGiftItemDisplayExt.jspf" %>
				</div>
			</th>
			<c:if test="${isFromOrderDetailsPage && !(orderStatus eq 'I')}">
				<flow:ifEnabled feature="FutureOrders">
					<c:set var="currentItemRequestedShipDate" value="${orderItem.requestedShipDate}"/>
					<c:set var="formattedDate" value=""/> <%-- Reset to empty value. Otherwise previous orderItem date will be displayed for current item --%>
					<c:if test='${!empty currentItemRequestedShipDate}'>
						<c:catch>
							<fmt:parseDate parseLocale="${dateLocale}" var="expectedShipDate" value="${currentItemRequestedShipDate}" pattern="yyyy-MM-dd'T'HH:mm:ss.SSS'Z'" timeZone="GMT"/>
						</c:catch>
						<c:if test="${empty expectedShipDate}">
							<c:catch>
								<fmt:parseDate parseLocale="${dateLocale}" var="expectedShipDate" value="${currentItemRequestedShipDate}" pattern="yyyy-MM-dd'T'HH:mm:ss'Z'" timeZone="GMT"/>
							</c:catch>
						</c:if>
						<fmt:formatDate value="${expectedShipDate}" type="date" dateStyle="long" var="formattedDate" timeZone="${fn:replace(cookie.WC_timeoffset.value, '%2B', '+')}"/>
					</c:if>
					<td class="requestedShippingDate ${fn:escapeXml(nobottom)}" id="WC_OrderItemDetailsSummaryf_td_requestedShippingDate_${fn:escapeXml(status.count)}" headers="SingleShipment_tableCell_requestedShippingDate SingleShipment_rowHeader_product${fn:escapeXml(status.count)}">
						<c:choose>
							<c:when test="${!empty formattedDate}">
								<span class="text"><c:out value="${formattedDate}"/></span>
							</c:when>
							<c:otherwise>
								<%-- Displays a blank space, because otherwise IE would not display the table border for an empty table cell. --%>
								&nbsp;
							</c:otherwise>
						</c:choose>
					</td>
				</flow:ifEnabled>
			</c:if>
			<flow:ifEnabled feature="ExpeditedOrders">
				<c:if test="${orderStatus != 'I' && !isOrderScheduled}">
					<td class="expedite ${fn:escapeXml(nobottom)}" id="WC_OrderItemDetailsSummaryf_td_expedite_${fn:escapeXml(status.count)}" headers="SingleShipment_tableCell_expedite SingleShipment_rowHeader_product${fn:escapeXml(status.count)}">
						<c:choose>
							<c:when test="${orderItem.orderItemShippingInfo.expedite}">
								<fmt:message bundle="${storeText}" key="YES"/>
							</c:when>
							<c:otherwise>
								<fmt:message bundle="${storeText}" key="NO"/>
							</c:otherwise>
						</c:choose>
					</td>
				</c:if>
			</flow:ifEnabled>

			<c:choose>
				<c:when test="${isSBSEnabled == 'Y' && orderPage == 'confirmation' && isFromOrderDetailsPage=='true'}">
					<td class="avail ${fn:escapeXml(nobottom)}" id="WC_OrderItemDetailsSummaryf_td_1_${fn:escapeXml(status.count)}" headers="SingleShipment_tableCell_availability SingleShipment_rowHeader_product${fn:escapeXml(status.count)}">
						<c:choose>
							<c:when test="${!empty orderItem.orderItemStatus}">
								<c:choose>
									<c:when test="${orderItem.orderItemStatus == 'H'}">
										<span><fmt:message bundle="${storeText}" key="MO_OrderStatus_M"/></span>
									</c:when>
									<c:otherwise>
										<span><fmt:message bundle="${storeText}" key="MO_OrderStatus_${orderItem.orderItemStatus}"/></span>
									</c:otherwise>
								</c:choose>
							</c:when>
							<c:otherwise>
								<fmt:message bundle="${storeText}" key="MO_NOT_AVAILABLE"/>
							</c:otherwise>
						</c:choose>
					</td>
				</c:when>
				<c:otherwise>
					<td class="avail ${fn:escapeXml(nobottom)}" id="WC_OrderItemDetailsSummaryf_td_1_${fn:escapeXml(status.count)}" headers="SingleShipment_tableCell_availability SingleShipment_rowHeader_product${fn:escapeXml(status.count)}">
						<%@ include file="../../../Snippets/ReusableObjects/CatalogEntryAvailabilityDisplay.jspf" %>
					</td>
				</c:otherwise>
			</c:choose>
			<td class="QTY ${fn:escapeXml(nobottom)}" id="WC_OrderItemDetailsSummaryf_td_2_${fn:escapeXml(status.count)}" headers="SingleShipment_tableCell_quantity SingleShipment_rowHeader_product${fn:escapeXml(status.count)}">
				<p class="item-quantity">
				<c:choose>
							<c:when test="${!empty quickCartOrderItemQuantity}">
								<c:out value="${quickCartOrderItemQuantity}"/>
							</c:when>
							<c:otherwise>
								<fmt:message bundle="${storeText}" key="MO_NOT_AVAILABLE"/>
							</c:otherwise>
					</c:choose>

				</p>
			</td>
			<td class="each ${fn:escapeXml(nobottom)}" id="WC_OrderItemDetailsSummaryf_td_3_${fn:escapeXml(status.count)}" headers="SingleShipment_tableCell_unitPrice SingleShipment_rowHeader_product${fn:escapeXml(status.count)}">
				<%-- unit price column of order item details table --%>
				<%-- shows unit price of the order item --%>
				<span class="price">

					<c:choose>
							<c:when test="${!empty orderItem.unitPrice}">
								<fmt:formatNumber value="${orderItem.unitPrice}" type="currency" maxFractionDigits="${env_currencyDecimal}" currencySymbol="${env_CurrencySymbolToFormat}"/>
								<c:out value="${CurrencySymbol}"/>
							</c:when>
							<c:otherwise>
								<fmt:message bundle="${storeText}" key="MO_NOT_AVAILABLE"/>
							</c:otherwise>
					</c:choose>


				</span>
			</td>
			<td class="total ${fn:escapeXml(nobottom)}" id="WC_OrderItemDetailsSummaryf_td_4_${fn:escapeXml(status.count)}" headers="SingleShipment_tableCell_totalPrice SingleShipment_rowHeader_product${fn:escapeXml(status.count)}">
				<c:choose>
					<c:when test="${orderItem.freeGift}">
						<%-- the OrderItem is a freebie --%>
						<span class="details">
							<fmt:message bundle="${storeText}" key="Free"/>
						</span>
					</c:when>
					<c:otherwise>
						<span class="price">
							<c:choose>
							<c:when test="${!empty orderItem.orderItemPrice}">
								<fmt:formatNumber var="totalFormattedProductPrice" value="${orderItem.orderItemPrice}" type="currency" maxFractionDigits="${env_currencyDecimal}" currencySymbol="${env_CurrencySymbolToFormat}"/>
							<c:out value="${totalFormattedProductPrice}" escapeXml="false" />
							<c:out value="${CurrencySymbol}"/>
							</c:when>
							<c:otherwise>
								<fmt:message bundle="${storeText}" key="MO_NOT_AVAILABLE"/>
							</c:otherwise>
					</c:choose>


						</span>
					</c:otherwise>
				</c:choose>
			</td>
		</tr>
		<c:remove var="nobottom"/>

		<%-- row to display product level discount --%>
		<c:if test="${!empty orderItem.adjustment}">
			<jsp:useBean id="aggregatedDiscounts" class="java.util.HashMap" scope="page" />
			<jsp:useBean id="discountReferences" class="java.util.HashMap" scope="page" />

			<%-- Loop through the discounts, summing discounts with the same code --%>
			<c:forEach var="discounts" items="${orderItem.adjustment}">
				<%-- only show the adjustment detail if display level is OrderItem, if display level is order, display it at the order summary section --%>
				<c:if test="${discounts.displayLevel == 'OrderItem'}">
					<c:set property="${discounts.code}" value="${discounts}" target="${discountReferences}"/>
					<c:if test="${empty aggregatedDiscounts[discounts.code]}">
						<c:set property="${discounts.code}" value="0" target="${aggregatedDiscounts}"/>
					</c:if>
					<c:set property="${discounts.code}" value="${aggregatedDiscounts[discounts.code]+discounts.amount}" target="${aggregatedDiscounts}"/>
				</c:if>
			</c:forEach>

			<c:forEach var="discountsIterator" items="${discountReferences}" varStatus="status2">
				<c:set var="discounts" value="${discountsIterator.value}" />
				<%-- only show the adjustment detail if display level is OrderItem, if display level is order, display it at the order summary section --%>
				<c:if test="${discounts.displayLevel == 'OrderItem'}">
					<tr>
						<th colspan="${fn:escapeXml(th_count)}" class="th_align_left_dotted_top_solid_bottom" abbr="<fmt:message bundle="${storeText}" key="Checkout_ACCE_prod_discount" /> ${fn:escapeXml(catEntry.name)}" id="SingleShipment_rowHeader_discount${fn:escapeXml(status.count)}_${fn:escapeXml(status2.count)}">
							<div class="itemspecs" id="WC_OrderItemDetailsSummaryf_div_3_${fn:escapeXml(status.count)}_${fn:escapeXml(status2.count)}">
								<c:url var="DiscountDetailsDisplayViewURL" value="DiscountDetailsDisplayView">
									<c:param name="code" value="${discounts.code}" />
									<c:param name="langId" value="${langId}" />
									<c:param name="storeId" value="${WCParam.storeId}" />
									<c:param name="catalogId" value="${WCParam.catalogId}" />
								</c:url>
								<a class="discount hover_underline" href="${fn:escapeXml(DiscountDetailsDisplayViewURL)}" id="WC_OrderItemDetails_Link_ItemDiscount_1_${fn:escapeXml(status.count)}_${fn:escapeXml(status2.count)}"
									<img src="<c:out value="${jspStoreImgDir}" />images/empty.gif" alt="<fmt:message bundle="${storeText}" key="Checkout_ACCE_prod_discount" /> <c:out value="${fn:replace(catalogEntry.description.name, search, replaceStr)}" escapeXml="false"/>"/>
									<c:out 	value="${discounts.description}" escapeXml="false"/>
								</a>
								<br />
							</div>
						</th>
						<td class="th_align_left_dotted_top_solid_bottom total" id="WC_OrderItemDetailsSummaryf_td_5_${fn:escapeXml(status.count)}_${fn:escapeXml(status2.count)}" headers="SingleShipment_rowHeader_discount${fn:escapeXml(status.count)}_${fn:escapeXml(status2.count)}">
							<fmt:formatNumber var="formattedDiscountValue" value="${aggregatedDiscounts[discounts.code]}" type="currency" maxFractionDigits="${env_currencyDecimal}" currencySymbol="${env_CurrencySymbolToFormat}"/>
							<c:out value="${formattedDiscountValue}" escapeXml="false" />
							<c:out value="${CurrencySymbol}"/>
							<br />
						</td>
					</tr>
				</c:if>
			</c:forEach>
			<c:remove var="aggregatedDiscounts"/>
			<c:remove var="discountReferences"/>
		</c:if>
		<c:remove var="catEntry"/>
		</c:if>
	</c:forEach>
	<%-- dont change the name of this hidden input element. This variable is used in CheckoutHelper.js --%>
	<input type="hidden" id = "totalNumberOfItems" name="totalNumberOfItems" value='<c:out value="${totalNumberOfItems}"/>'/>
 </table>

<flow:ifEnabled feature="Analytics">
	<c:if test="${not empty parentCatalogEntryIDs }" >
		<c:catch var="searchServerException">
			<wcf:rest var="parentCatalogEntries" url="${searchHostNamePath}${searchContextPath}/store/${WCParam.storeId}/productview/byIds" >
				<c:forTokens var="parentID" items="${parentCatalogEntryIDs}" delims=",">
						<wcf:param name="id" value="${parentID}"/>
				</c:forTokens>
				<wcf:param name="langId" value="${langId}" />
				<wcf:param name="currency" value="${env_currencyCode}" />
				<wcf:param name="responseFormat" value="json" />
				<wcf:param name="catalogId" value="${sdb.masterCatalog.catalogId}" />
				<wcf:param name="profileName" value="IBM_findProductByIds_Basic_Summary" />
			</wcf:rest>
		</c:catch>
		<c:forEach var="aCatEntry" items="${parentCatalogEntries.catalogEntryView}">
			<c:if test="${aCatEntry.partNumber != null && !empty aCatEntry.partNumber}">
				<c:choose>
					<c:when test="${empty order_partnumbers}" >
						<c:set var="order_partnumbers" value="${aCatEntry.partNumber}" />
					</c:when>
					<c:otherwise>
						<c:set var="order_partnumbers" value="${order_partnumbers}|${aCatEntry.partNumber}" />
					</c:otherwise>
				</c:choose>
			</c:if>
		</c:forEach>
		<flow:ifEnabled feature="ShowHideOrderItems">
			<input type="hidden" id="orderPartNumbers" name="orderPartNumbers" value="<c:out value='${order_partnumbers}'/>"/>
		</flow:ifEnabled>
	</c:if>
	<script type="text/javascript">
		$(document).ready(function() {
            wcTopic.publish("order_contents_ProductRec", "<c:out value='${order_partnumbers}'/>");
		});
	</script>
</flow:ifEnabled>
<c:remove var="order_partnumbers"/>


<c:if test="${empty subscriptionOrderItemId}">
	<c:if test="${numEntries > pageSize}">
		<div class="shopcart_pagination" id="OrderItemDetailSummaryPagination2">
			<span class="text">
				<fmt:message bundle="${storeText}" key="CATEGORY_RESULTS_DISPLAYING">
					<fmt:param><fmt:formatNumber value="${beginIndex + 1}"/></fmt:param>
					<fmt:param><fmt:formatNumber value="${endIndex}"/></fmt:param>
					<fmt:param><fmt:formatNumber value="${numEntries}"/></fmt:param>
				</fmt:message>
				<span class="paging">
					<c:if test="${beginIndex != 0}">
						<a id="OrderItemDetailSummaryPagination2_1" class="tlignore" href="javaScript:setCurrentId('OrderItemDetailSummaryPagination2_1'); if(submitRequest()){ cursor_wait();
						wcRenderContext.updateRenderContext('OrderItemPaginationDisplay_Context',{'beginIndex':'<c:out value='${beginIndex - pageSize}'/>','pageSize':'<c:out value='${pageSize}'/>','externalOrderId':'${WCParam.externalOrderId}','externalQuoteId':'${WCParam.externalQuoteId}','isFromOrderDetailsPage':'<c:out value='${isFromOrderDetailsPage}'/>'});}">
					</c:if>
					<img src="<c:out value="${jspStoreImgDir}${env_vfileColor}${vfileColorBIDI}" />paging_back.png" alt="<fmt:message bundle="${storeText}" key="CATEGORY_PAGING_LEFT_IMAGE"/>"/>
					<c:if test="${beginIndex != 0}">
						</a>
					</c:if>
					<fmt:message bundle="${storeText}" key="CATEGORY_RESULTS_PAGES_DISPLAYING">
						<fmt:param><fmt:formatNumber value="${currentPage}"/></fmt:param>
						<fmt:param><fmt:formatNumber value="${totalPages}"/></fmt:param>
					</fmt:message>
					<c:if test="${numEntries > endIndex }">
						<a id="OrderItemDetailSummaryPagination2_2" class="tlignore" href="javaScript:setCurrentId('OrderItemDetailSummaryPagination2_2'); if(submitRequest()){ cursor_wait();
						wcRenderContext.updateRenderContext('OrderItemPaginationDisplay_Context',{'beginIndex':'<c:out value='${beginIndex + pageSize}'/>','pageSize':'<c:out value='${pageSize}'/>','externalOrderId':'${WCParam.externalOrderId}','externalQuoteId':'${WCParam.externalQuoteId}','isFromOrderDetailsPage':'<c:out value='${isFromOrderDetailsPage}'/>'});}">
					</c:if>
					<img src="<c:out value="${jspStoreImgDir}${env_vfileColor}${vfileColorBIDI}" />paging_next.png" alt="<fmt:message bundle="${storeText}" key="CATEGORY_PAGING_RIGHT_IMAGE"/>"/>
					<c:if test="${numEntries > endIndex }">
						</a>
					</c:if>
				</span>
			</span>
		</div>
	</c:if>
</c:if>
<!-- END OrderItemDetailSummary.jsp -->







Part 2 Step 1


-- AccountSummary_UI.jspf where we fetch the favourite data using wcf:rest

<%--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
--%>

<!-- BEGIN AccountSummary_UI.jspf -->

<div class="my_account_summary">
	<div class="info_table">
		<div class="row">
			<div class="label">
				<wcst:message bundle="${widgetText}" key="MA_NAME" />
			</div>
			<div class="info_content">
				<%-- Use a single c:out and space if useCDataTrim is on --%>
				<c:choose>
					<c:when
						test="${locale == 'ja_JP' || locale == 'ko_KR' || locale == 'zh_CN' || locale == 'zh_TW'}">
						<c:out value="${lastName} ${firstName}" />
						<c:set var="userNameForHeaderLink"
							value="${lastName} ${firstName}" />
					</c:when>
					<c:otherwise>
						<c:out value="${firstName} ${middleName} ${lastName}" />
						<c:set var="userNameForHeaderLink"
							value="${firstName} ${lastName}" />
					</c:otherwise>
				</c:choose>
				<c:set var="userNameForHeaderLink"
					value="${fn:trim(userNameForHeaderLink)}" />
			</div>
			<div class="clear_float"></div>
		</div>
		<div class="row">
			<div class="label">
				<wcst:message bundle="${widgetText}" key="MA_ADDRESS" />
			</div>
			<div class="info_content">
				<c:out value="${street} ${street2}" />
			</div>
			<div class="clear_float"></div>
		</div>
		<div class="row">
			<div class="label">
				<wcst:message bundle="${widgetText}" key="MA_CITY" />
			</div>
			<div class="info_content">
				<c:out value="${city}" />
			</div>
			<div class="clear_float"></div>
		</div>
		<div class="row">
			<div class="label">
				<wcst:message bundle="${widgetText}" key="MA_EMAIL" />
			</div>
			<div class="info_content">
				<c:out value="${email1}" />
			</div>
			<div class="clear_float"></div>
		</div>
		<%-- START: CUSTOMVIEW ADDING FAVOURITECOLOR AND FOOD --%>
		<wcf:rest var="favourites" url="store/{storeId}/favourite/{userId}">
			<wcf:var name="storeId" value="${WCParam.storeId }" />
			<wcf:var name="userId" value="${person.userId }" />
		</wcf:rest>
		<c:set var="favouriteColour" value="${favourites.favouriteColour}" />
		<c:set var="favouriteFood" value="${favourites.favouriteFood}" />
		<c:if
			test="${!empty favouriteColour && favouriteColour != null  && !empty favouriteFood && favouriteFood != null}">
			<div class="row">
				<div class="label">Favourite Food</div>
				<div class="info_content">
					<c:out value="${favouriteFood}" />
				</div>
				<div class="clear_float"></div>
			</div>
			<div class="row">
				<div class="label">Favourite Colour</div>
				<div class="info_content">
					<c:out value="${favouriteColour}" />
				</div>
				<div class="clear_float"></div>
			</div>
		</c:if>
		<%-- END: CUSTOMVIEW ADDING FAVOURITECOLOR AND FOOD --%>
	</div>

	<div class="footer">
		<a href="<c:out value='${userRegistrationFormURL}' />"
			class="myaccount_link hover_underline"
			id="WC_MyAccountCenterLinkDisplay_inputs_1"><wcst:message
				bundle="${widgetText}" key="MA_EDIT" /></a>
		</p>
	</div>
</div>

<!-- END AccountSummary_UI.jspf -->







-- FavouriteInfoForm.jspf where we created form for submitting favourite data

<script>
	wcService
			.declare({
				id : "AjaxSaveFavourites",
				actionId : "AjaxSaveFavourites",
				url : "AjaxSaveFavourites",
				formId : ""

				/**
				 * Clear messages on the page.
				 * @param (object) serviceResponse The service response object, which is the JSON object returned by the service invocation
				 */
				,
				successHandler : function(serviceResponse) {
					console.debug("Save Favourite Success");
					alert("Update additional information success!")
					cursor_clear();
				}

				/**
				 * Displays an error message on the page if the request failed.
				 * @param (object) serviceResponse The service response object, which is the JSON object returned by the service invocation.
				 */
				,
				failureHandler : function(serviceResponse) {
					console.debug("Save Favourite failed");
					if (serviceResponse.errorMessage) {
						MessageHelper
								.displayErrorMessage(serviceResponse.errorMessage);
					}
					cursor_clear();
				}
			})

	function SaveFavouriteData(userId, favouriteFood, favouriteColour) {
		params = [];
		params["storeId"] = this.storeId;
		params["catalogId"] = this.catalogId;
		params["langId"] = this.langId;
		params.userId = userId;
		params.favouriteFood = favouriteFood;
		params.favouriteColour = favouriteColour

		// For handling multiple clicks
		if (!submitRequest()) {
			return;
		}
		cursor_wait();

		wcService.invoke("AjaxSaveFavourites", params);
	}

	$(document)
			.ready(
					function() {
						$("#SaveAdditionalInformation_1")
								.on(
										"submit",
										function(event) {
											event.preventDefault();
											var favouriteFood = document
													.getElementById("WC_AdditionalInformationForm_FavouriteFoodEntryForm_FormInput_favouriteFood_1").value;
											var favouriteColour = document
													.getElementById("WC_AdditionalInformationForm_FavouriteColourEntryForm_FormInput_favouriteColour_1").value;
											var userId = document
													.getElementById("WC_AdditionalInformationForm_FormInput_userId_In_Register_991").value;
											if (favouriteFood
													&& favouriteColour
													&& userId) {
												SaveFavouriteData(userId,
														favouriteFood,
														favouriteColour);
											}

										});
					})
</script>

<%-- GET THE CURRENT VALUES OF FAVOURITES --%>
<wcf:rest var="favourites" url="store/{storeId}/favourite/{userId}">
	<wcf:var name="storeId" value="${WCParam.storeId }" />
	<wcf:var name="userId" value="${person.userId }" />
</wcf:rest>

<!-- BEGIN ext/PersonalInformation_UI.jsp -->
<%-- END: CUSTOMVIEW Adding form for favourite food and color --%>
<div id="box" class="myAccountMarginRight">
	<div class="my_account" id="WC_RegistrationUpdateCommonPage_div_991">
		<h2 class="myaccount_header">Additional Information</h2>
		<div class="body" id="WC_UserRegistrationUpdateForm_div_9910">
			<div class="form_2column" id="WC_UserRegistrationUpdateForm_div_9911">
				<form name="SaveAdditionalInformation_1"
					id="SaveAdditionalInformation_1" method="post">
					<input type="hidden" name="storeId"
						value="<c:out value="${WCParam.storeId}"/>"
						id="WC_AdditionalInformationForm_FormInput_storeId_In_Register_991" />
					<input type="hidden" name="userId"
						value="<c:out value="${person.userId}"/>"
						id="WC_AdditionalInformationForm_FormInput_userId_In_Register_991" />
					<div class="column"
						id="WC_AdditionalInformationEntryForm_div_firstname">
						<div id="WC_AdditionalInformationEntryForm_div_9917"
							class="column_label">
							<span class="spanacce"> <label
								for="WC_AdditionalInformationForm_FavouriteFoodEntryForm_FormInput_favouriteFood_1">
									Favourite food: </label>
							</span> Favourite food:
						</div>
						<input class="inputField" type="text" maxlength="40" size="35"
							id="WC_AdditionalInformationForm_FavouriteFoodEntryForm_FormInput_favouriteFood_1"
							name="favouriteFood" value="${favourites.favouriteFood }"
							style="margin-bottom: 10px" />
					</div>
					<div class="column"
						id="WC_AdditionalInformationEntryForm_div_firstname">
						<div id="WC_AdditionalInformationEntryForm_div_9916"
							class="column_label">
							<span class="spanacce"> <label
								for="WC_AdditionalInformationForm_FavouriteColourEntryForm_FormInput_favouriteColour_1">
									Favourite colour: </label>
							</span> Favourite colour:
						</div>
						<input class="inputField" type="text" maxlength="40" size="35"
							id="WC_AdditionalInformationForm_FavouriteColourEntryForm_FormInput_favouriteColour_1"
							name="favouriteColour" value="${favourites.favouriteColour }"
							style="margin-bottom: 10px" />
					</div>
					<div>
						<input type="submit" value="Save information" />
					</div>
				</form>
			</div>
		</div>
	</div>
</div>
<%-- END: CUSTOMVIEW Adding form for favourite food and color --%>
<!-- END ext/PersonalInformation_UI.jsp -->






-- PersonalInformation_UI.jspf where we included the FavouriteInfoForm.jspf at the end

<%--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
--%>	

<!-- BEGIN PersonalInformation_UI.jsp -->
<c:if test="${env_shopOnBehalfSessionEstablished eq 'true'}">
	<div class="listTable listTable_CSR_resetPassword" id="csr_reset_password">
		<form name="ResetPasswordAction_AuthTokenInfo"  id="ResetPasswordAction_AuthTokenInfo">
			<input type="hidden" name="authToken" id="ResetPasswordAction_authToken" value="<c:out value='${authToken}'/>"/>
		</form>	 
		<div class="row">
			<div class="col12">
				<div aria-label='<wcst:message bundle="${widgetText}" key="RESET_PASSWORD" />' class="toolbar">
					<div class="newList">
						<a id="csr_resetPassword_button" aria-haspopup="true" class="button_secondary toolbarButton" aria-label='<wcst:message bundle="${widgetText}" key = "RESET_PASSWORD_ARIA_MEESAGE" />' href="#" onclick="javascript:registeredCustomersJS.handleCSRPasswordReset(event);return false;">
							<div class="left_border"></div>
							<div class="button_text"><span><wcst:message bundle="${widgetText}" key="RESET_PASSWORD" /></span></div>								
							<div class="right_border"></div>
						</a>						
						<div aria-label='<wcst:message bundle="${widgetText}" key="RESET_PASSWORD" />' class="toolbarDropdown" id="csr_resetPassword_dropdown_panel">
							<div class="createTableList">
								<%--
									Use this when CSR password is mandatory for resetting customer password.
								<label for="administratorPassword"><wcst:message bundle="${widgetText}" key="RESET_PASSWORD_MESSAGE" /></label>
								<input type="password" maxlength="254" class="input_field" name="administratorPassword" id="administratorPassword" onkeypress="javascript:registeredCustomersJS.hideErrorDiv();">
								--%>
								<span id="csr_resetPassword_confirmation"><wcst:message bundle="${widgetText}" key="RESET_PASSWORD_CONFIRMATION_MESSAGE" /></span>

								<div class="hidden csr_errorMsg" id="csr_resetPassword_error">
									<span id="csr_resetPassword_error_msg"  tabindex="0"><wcst:message bundle="${widgetText}" key="RESET_PASSWORD_MESSAGE" /></span>
								</div>

								<a role="button" class="button_primary clicked" id="csr_password_ok" href="#"		onclick="javascript:registeredCustomersJS.resetPasswordByAdminOnBehalf('${person.logonId}');">
									<div class="left_border"></div>
									<div class="button_text"><span><wcst:message bundle="${widgetText}" key="RESET_PASSWORD_OK" /></span></div>								
									<div class="right_border"></div>
								</a>
								
								<a role="button" class="button_secondary clicked" id="csr_password_cancel" href="#"		onclick="javascript:registeredCustomersJS.handleCSRPasswordReset(event);return false;" >
									<div class="left_border"></div>
									<div class="button_text"><span><wcst:message bundle="${widgetText}" key="RESET_PASSWORD_CANCEL" /></span></div>							
									<div class="right_border"></div>
								</a>
								<div class="clearFloat"></div>
							</div>
						</div>
					</div>
					<div class="clearFloat"></div>
				</div>
			</div>
		</div>
	</div>
</c:if>

<div id="box" class="myAccountMarginRight">
	<div class="my_account" id="WC_RegistrationUpdateCommonPage_div_1">
		<h2 class="myaccount_header"><wcst:message bundle="${widgetText}" key="MA_PERSONAL_INFO" /></h2>
		<div class="content_header" id="WC_UserRegistrationUpdateForm_div_6">
			<div class="left_corner" id="WC_UserRegistrationUpdateForm_div_7"></div>
			<div  id="WC_UserRegistrationUpdateForm_div_8" class="headingtext">
				<span class="content_text">
					<wcst:message bundle="${widgetText}" key="PI_WELCOMEBACK" >
						<wcst:param><c:out value="${firstName}"/></wcst:param>
						<wcst:param><c:out value="${middleName}"/></wcst:param>
						<wcst:param><c:out value="${lastName}"/></wcst:param>
						<wcst:param><c:out value="${personSession.lastSession}"/></wcst:param>
					</wcst:message>
				</span>
			</div>
			<div class="right_corner" id="WC_UserRegistrationUpdateForm_div_9"></div>
		</div>
		<div class="body" id="WC_UserRegistrationUpdateForm_div_10">
			<div class="form_2column" id="WC_UserRegistrationUpdateForm_div_11">
				<form name="Register" method="post" action="RESTUserRegistrationUpdate" id="Register">
					<input type="hidden" name="storeId" value="<c:out value="${WCParam.storeId}"/>" id="WC_UserRegistrationUpdateForm_FormInput_storeId_In_Register_1"/>
					<input type="hidden" name="catalogId" value="<c:out value="${WCParam.catalogId}"/>" id="WC_UserRegistrationUpdateForm_FormInput_catalogId_In_Register_1"/>
					<input type="hidden" name="URL" value="<c:out value='${LogonForm}'/>" id="WC_UserRegistrationUpdateForm_FormInput_URL_In_Register_1"/>
					<input type="hidden" name="errorViewName" value="UserRegistrationForm" id="WC_UserRegistrationUpdateForm_FormInput_errorViewName_In_Register_1"/>
					<input type="hidden" name="registerType" value="RegisteredPerson" id="WC_UserRegistrationUpdateForm_FormInput_registerType_In_Register_1"/>
					<input type="hidden" name="editRegistration" value="Y" id="WC_UserRegistrationUpdateForm_FormInput_editRegistration_In_Register_1"/>
					<input type="hidden" name="receiveEmail" value="" id="WC_UserRegistrationUpdateForm_FormInput_receiveEmail_In_Register_1"/>
					<input type="hidden" name="receiveSMSNotification" value="" id="WC_UserRegistrationUpdateForm_FormInput_receiveSMSNotification_In_Register_1"/>
					<input type="hidden" name="receiveSMS" value="" id="WC_UserRegistrationUpdateForm_FormInput_receiveSMS_In_Register_1"/>
					<input type="hidden" name="logonId" value="<c:out value="${person.logonId}"/>" id="WC_UserRegistrationUpdateForm_FormInput_logonId_In_Register_1_1"/>
					<input type="hidden" name="authToken" value="${authToken}" id="WC_UserRegistrationUpdateForm_FormInput_authToken_In_Register_1"/>
					<span class="required-field" id="WC_UserRegistrationUpdateForm_div_12"> *</span>
					<wcst:message bundle="${widgetText}" key="REQUIRED_FIELDS" />
					<%-- The challenge answer and question are necessary for the forget password feature. Therefore, they are set to "-" here.       --%>
					<input type="hidden" name="challengeQuestion" value="-" id="WC_UserRegistrationUpdateForm_FormInput_challengeQuestion_In_Register_1"/>
					<input type="hidden" name="challengeAnswer" value="-" id="WC_UserRegistrationUpdateForm_FormInput_challengeAnswer_In_Register_1"/>
					<br />
	
					<br clear="all" />
					
					<c:set var="paramPrefix" value=""/>
					<c:set var="formName" value="document.Register.name" />
					<c:set var="pageName" value="UserRegistrationUpdateForm" />
					
					<wcpgl:widgetImport useIBMContextInSeparatedEnv="${isStoreServer}" url="${env_siteWidgetsDir}com.ibm.commerce.store.widgets.AddressForm/AddressForm.jsp">
						<wcpgl:param name="addressId" value="${addressId}" />
						<wcpgl:param name="nickName" value="${nickName}" />
						<wcpgl:param name="firstName" value="${firstName}"/>
						<wcpgl:param name="lastName" value="${lastName}"/>
						<wcpgl:param name="middleName" value="${middleName}"/>
						<wcpgl:param name="address1" value="${street}"/>
						<wcpgl:param name="address2" value="${street2}"/>
						<wcpgl:param name="city" value="${city}"/>
						<wcpgl:param name="state" value="${state}"/>
						<wcpgl:param name="countryReg" value="${country1}"/>
						<wcpgl:param name="zipCode" value="${zipCode}"/>
						<wcpgl:param name="phone" value="${phone1}"/>
						<wcpgl:param name="email1" value="${email1}"/>
						<wcpgl:param name="emailOption" value="${emailOption}"/>
						<wcpgl:param name="gender" value="${gender}"/>
						<wcpgl:param name="dateOfBirth" value="${dateOfBirth}"/>
						<wcpgl:param name="mobilePhone1" value="${mobilePhoneNumber1}"/>
						<wcpgl:param name="mobilePhone1Country" value="${mobilePhoneNumber1Country}"/>
						<wcpgl:param name="mobilePhone1CountryCode" value="${mobilePhoneNumber1CountryCode}"/>
						<wcpgl:param name="receiveSMSNotification" value="${receiveSMSNotification}"/>
						<wcpgl:param name="receiveSMSPreference" value="${receiveSMSPreference}"/>
						<wcpgl:param name="preferredLanguage" value="${preferredLanguage}"/>
						<wcpgl:param name="preferredCurrency" value="${preferredCurrency}"/>
						<wcpgl:param name="formName" value="${formName}"/>
						<wcpgl:param name="pageName" value="${pageName}"/>
						<wcpgl:param name="flexFlowsFieldOrder" value="EmailOption,preferredLanguage,preferredCurrency,Age,Gender,DateOfBirth,MobilePhone,RememberMe,MarketingConsent"/>
					</wcpgl:widgetImport>
				
					<br clear="all" />
					<br />
				</form>
			</div>
		</div>
	</div>
	<div id="WC_UserRegistrationUpdateForm_div_40">
		<div class="button_footer_line" id="WC_UserRegistrationUpdateForm_div_42">
			<a href="#" role="button" class="button_primary" id="WC_UserRegistrationUpdateForm_links_1" onclick="javascript:MyAccountDisplay.prepareSubmit(document.Register,'<c:out value='${logonPassword}'/>','<c:out value='${logonPasswordVerify}'/>');return false;">
				<div class="left_border"></div>
				<div class="button_text"><wcst:message bundle="${widgetText}" key="UPDATE" /></div>												
				<div class="right_border"></div>
			</a>	
		</div>
	</div>
</div>
<%-- START: CUSTOMVIEW ADD FAVOURITE COLOR AND FOOD FORM --%>
<%@ include file="/AuroraStorefrontAssetStore/Custom/FavouriteInfoForm.jspf" %>
<%-- END: CUSTOMVIEW ADD FAVOURITE COLOR AND FOOD FORM --%>
<!-- END PersonalInformation_UI.jsp -->




-- controllers-ext.xml where we map urls to specific beans for handling request

<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
-->
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">  
  <!-- Import customer controller files here 
  <import resource="classpath:/WEB-INF/spring/AuroraStorefrontAssetStore/{my-controllers.xml}"/>
  -->  
  <bean id="actionUrlmapping-AuroraStorefrontAssetStore" class="com.ibm.commerce.store.mvc.registry.spring.StoreUrlHandlerMapping"> 
    <property name="order" value="0"/>  
    <property name="mappings"> 
      <props> 
      <!-- B2C delta controller config -->
      <!-- Add customer controller url mappings here  
      <prop key="/ProductDisplay/AuroraStorefrontAssetStore">productDisplay/AuroraStorefrontAssetStore</prop>
      -->
      	<prop key="/SaveRating">SaveRating</prop>
      	<prop key="/AjaxSaveRating">AjaxSaveRating</prop>
      	<prop key="/AjaxSaveFavourites">AjaxSaveFavourites</prop>
      	<prop key="/SaveFavourites">SaveFavourites</prop>
      	<!-- <prop key="/UserRegistrationAdd">registerCustom</prop> -->
      	<!--<prop key="/GetFavouriteFoodAndColour">getFavouriteFoodAndColor</prop>-->
      </props> 
    </property> 
  </bean>  
  <bean id="viewUrlmapping-AuroraStorefrontAssetStore" class="com.ibm.commerce.store.mvc.registry.spring.StoreUrlHandlerMapping"> 
    <property name="order" value="2"/>  
    <property name="mappings"> 
      <props>  	
      </props> 
    </property> 
    </bean>
  <!-- B2C delta controller config -->    
  <!-- Add customer controller bean definitions here
  <bean id="productDisplay/AuroraStorefrontAssetStore" class="com.ibm.commerce.store.mvc.controller.spring.BrowsingRESTActionController"> 
    <property name="authenticate" value="0"/>  
    <property name="https" value="1"/>  
    <property name="generic" value="1"/>
    <property name="parameter" value="productLayout.productLayout"/>
    <property name="credentialsAccepted" value="P"/>
  </bean>
  -->  
  <bean id="AjaxSaveFavourites" class="com.ibm.commerce.store.mvc.controller.spring.AjaxRESTActionController"> 
    <property name="authenticate" value="0"/>  
    <property name="https" value="0"/>  
    <property name="generic" value="1"/>  
    <property name="parameter" value="favouriteHandler.saveFavourite"/> 
  </bean> 
  <bean id="SaveRating" class="com.ibm.commerce.store.mvc.controller.spring.RESTActionController"> 
    <property name="authenticate" value="0"/>  
    <property name="https" value="0"/>  
    <property name="generic" value="1"/>  
    <property name="parameter" value="ratingHandler.saveRatingData"/> 
  </bean>
    <bean id="AjaxSaveRating" class="com.ibm.commerce.store.mvc.controller.spring.AjaxRESTActionController"> 
    <property name="authenticate" value="0"/>  
    <property name="https" value="0"/>  
    <property name="generic" value="1"/>  
    <property name="parameter" value="ratingHandler.saveRatingData"/> 
  </bean>

    <bean id="SaveFavourites" class="com.ibm.commerce.store.mvc.controller.spring.RESTActionController"> 
    <property name="authenticate" value="0"/>  
    <property name="https" value="0"/>  
    <property name="generic" value="1"/>  
    <property name="parameter" value="favouriteHandler.saveFavourite"/> 
  </bean>
   <bean id="registerCustom" class="com.ibm.commerce.store.mvc.controller.spring.UserRegistrationController"> 
    <property name="https" value="1"/>  
    <property name="authenticate" value="0"/>  
    <property name="parameter" value="customPersonHandler.registerPerson"/> 
    <property name="generic" value="1"/>
    <property name="csrfProtected" value="1"/> 
    </bean>
</beans>






-- /crs-web/WebContent/WEB-INF/xml/config/com.abc.commerce.favourite/rest-template-config.xml

<?xml version="1.0" encoding="UTF-8"?>
<_config:rest-action-config xmlns:_config="http://www.ibm.com/xmlns/prod/commerce/foundation/config" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.ibm.com/xmlns/prod/commerce/foundation/config ../../xsd/rest-action-config.xsd ">
	<resource path="{serverHost}/{contextPath}/store/{storeId}/favourite" name="favouriteHandler">
	 <serverParam name="serverHost">$WCParam.serverHost</serverParam>
	 <serverParam name="contextPath">$WCParam.contextPath</serverParam>
	 <serverParam name="storeId">$WCParam.storeId</serverParam>
		<method name="saveFavourite" httpMethod="POST" path="">
			<template>
				<![CDATA[{
				"userId" : "$userId",
				"favouriteFood" : "$favouriteFood",
				"favouriteColour": "$favouriteColour"
				}
				]]>
			</template>
		</method>
</resource>
</_config:rest-action-config>







-- /Rest/WebContent/WEB-INF/config/beanMapping-ext/com.abc.commerce.favourites.beans.FavouriteDataBean.xml where we do mapping for FavouriteDataBean input and output


<?xml version="1.0" encoding="UTF-8"?>
<bean>
  <profiles>
      <profile name="getFavouriteDetailsDataBean">
         <inputs>
            <input inputName="userId" methodName="setUserIdentifier"/>
         </inputs>
         <outputs>
            <output methodName="getUserIdentifier" outputName="userId"/>
            <output methodName="getFavouriteFood" outputName="favouriteFood"/>
            <output methodName="getFavouriteColour" outputName="favouriteColour"/>
         </outputs>
      </profile>
   </profiles>
</bean>







-- /Rest/WebContent/WEB-INF/config/commandMapping-ext/com.abc.commerce.favourites.commands.SaveFavouriteControllerCmd.xml

<?xml version="1.0" encoding="UTF-8"?>
<command>
   <profiles>
      <profile name="saveFavouriteDetails">
         <inputs>
            <input inputName="userId" methodName="setUserIdentifier"/>
            <input inputName="favouriteFood" methodName="setFavouriteFood"/>
            <input inputName="favouriteColour" methodName="setFavouriteColour"/>
         </inputs>
         <outputs>
            <output methodName="getUserIdentifier" outputName="userId"/>
            <output methodName="getFavouriteFood" outputName="favouriteFood"/>
            <output methodName="getFavouriteColour" outputName="favouriteColour"/>
         </outputs>
      </profile>
   </profiles>
</command>






-- /Rest/WebContent/WEB-INF/config/resources-ext.properties where we add custom handlers

#-----------------------------------------------------------------
# Licensed Materials - Property of IBM
#
# WebSphere Commerce
#
# (C) Copyright IBM Corp. 2010 All Rights Reserved.
#
# US Government Users Restricted Rights - Use, duplication or
# disclosure restricted by GSA ADP Schedule Contract with
# IBM Corp.
#-----------------------------------------------------------------

com.abc.commerce.rest.rating.handler.RatingHandler
com.abc.commerce.rest.member.handler.CustomPersonHandler
com.abc.commerce.favourites.handler.FavouriteHandler







-- Line added as property of Instance element at line 187

AccessControlUnitTest="true"






-- /WebSphereCommerceServerExtensionsData/ejbModule/com/abc/commerce/favourites/objects/Favourite.java

package com.abc.commerce.favourites.objects;

import java.io.Serializable;

import javax.persistence.Basic;
import javax.persistence.Column;
import javax.persistence.Entity;
import javax.persistence.Id;
import javax.persistence.NamedQueries;
import javax.persistence.NamedQuery;
import javax.persistence.Table;

import com.ibm.commerce.base.objects.EntityBase;
import com.ibm.commerce.security.Protectable;

@Entity
@Table(name = "X_CUSTOM_USER_INFORMATION")
@NamedQueries({
		@NamedQuery(name = "Favourite.getFavouriteByUserId", query = "select f from Favourite f where f.userId = :userId") })
public class Favourite extends EntityBase implements Protectable, Serializable {

	private Long favouriteId;
	private String userId;
	private String favouriteFood;
	private String favouriteColour;
	
	public Favourite() {
		
	}

	@Column(name = "X_USER_ID")
	public String getUserId() {
		return userId;
	}

	public void setUserId(String userId) {
		this.userId = userId;
	}

	@Column(name = "FAVORITE_FOOD")
	public String getFavouriteFood() {
		return favouriteFood;
	}

	public void setFavouriteFood(String favouriteFood) {
		this.favouriteFood = favouriteFood;
	}

	@Column(name = "FAVORITE_COLOR")
	public String getFavouriteColour() {
		return favouriteColour;
	}

	public void setFavouriteColour(String favouriteColour) {
		this.favouriteColour = favouriteColour;
	}

	@Column(name="CUSTOM_USER_INFORMATION_ID", nullable=false)
	@Basic(optional=false)
	@Id
	public Long getFavouriteId() {
		return favouriteId;
	}

	public void setFavouriteId(Long favouriteId) {
		this.favouriteId = favouriteId;
	}
}






-- /WebSphereCommerceServerExtensionsData/ejbModule/com/abc/commerce/rating/persistence/FavouriteDaoImpl.java

package com.abc.commerce.rating.persistence;

import java.util.ArrayList;
import java.util.List;

import javax.persistence.criteria.CriteriaBuilder;
import javax.persistence.criteria.CriteriaQuery;
import javax.persistence.criteria.Predicate;
import javax.persistence.criteria.Root;

import com.abc.commerce.favourites.objects.Favourite;
import com.abc.commerce.rating.objects.Rating;
import com.ibm.commerce.foundation.persistence.AbstractJPAEntityDaoImpl;

public class FavouriteDaoImpl extends AbstractJPAEntityDaoImpl<Favourite, Long> {

	public FavouriteDaoImpl() {
		super(Favourite.class);
	}

	@Override
	protected Predicate[] buildPredicates(CriteriaBuilder cb, CriteriaQuery<?> cq, Root<Favourite> root,
			String query, Object... queryParameters) {
		List<Predicate> predicateList = new ArrayList<Predicate>();
		if (query != null) {
			if ("Favourite.getFavouriteByUserId".equals(query)) {
				if (queryParameters != null && queryParameters.length == 1) {
					String userId = (String) queryParameters[0];
					if (userId != null) {
						predicateList.add(cb.equal(root.get("userId"), userId));
					}
				}
			}
		}
		Predicate[] predicates = new Predicate[predicateList.size()];
		predicateList.toArray(predicates);
		return predicates;
	}
}







-- /WebSphereCommerceServerExtensionsLogic/src/com/abc/commerce/favourites/beans/FavouriteDataBean.java

package com.abc.commerce.favourites.beans;

import java.util.List;

import javax.ejb.ObjectNotFoundException;

import com.abc.commerce.favourites.objects.Favourite;
import com.abc.commerce.rating.objects.Rating;
import com.abc.commerce.rating.persistence.FavouriteDaoImpl;
import com.abc.commerce.rating.persistence.RatingDaoImpl;
import com.ibm.commerce.base.objects.ServerJDBCHelperBean;
import com.ibm.commerce.beans.SmartDataBeanImpl;
import com.ibm.commerce.command.CommandContext;
import com.ibm.commerce.foundation.persistence.EntityDao;

public class FavouriteDataBean extends SmartDataBeanImpl {

	private Long resourceId;
	private String userIdentifier;
	private String favouriteFood;
	private String favouriteColour;

	public Long getResourceId() {
		return resourceId;
	}

	public void setResourceId(Long resourceId) {
		this.resourceId = resourceId;
	}

	public String getUserIdentifier() {
		return userIdentifier;
	}

	public void setUserIdentifier(String userIdentifier) {
		this.userIdentifier = userIdentifier;
	}

	public String getFavouriteFood() {
		return favouriteFood;
	}

	public void setFavouriteFood(String favouriteFood) {
		this.favouriteFood = favouriteFood;
	}

	public String getFavouriteColour() {
		return favouriteColour;
	}

	public void setFavouriteColour(String favouriteColour) {
		this.favouriteColour = favouriteColour;
	}

	@Override
	public void populate() throws Exception {
		
		super.populate();
		
		EntityDao<Favourite, Long> favouriteDao = new FavouriteDaoImpl();
		List<Favourite> favouriteList = favouriteDao.query("Favourite.getFavouriteByUserId", userIdentifier);

		System.out.println("found record:" + favouriteList);
		
		if(favouriteList!=null && favouriteList.size()>0){
			Favourite favourite=(Favourite)favouriteList.get(0);
			if(favourite!=null){
				System.out.println("favouriteId: " + favourite.getFavouriteId());
				System.out.println("userId:" + favourite.getUserId());
				System.out.println("favouriteColor:" + favourite.getFavouriteColour());
				System.out.println("favouriteFood:" + favourite.getFavouriteFood());
				
				setUserIdentifier(favourite.getUserId());
				setFavouriteColour(favourite.getFavouriteColour());
				setFavouriteFood(favourite.getFavouriteFood());
			}
		}
	}
}








-- /WebSphereCommerceServerExtensionsLogic/src/com/abc/commerce/favourites/commands/SaveFavouriteControllerCmd.java

package com.abc.commerce.favourites.commands;

import com.ibm.commerce.command.ControllerCommand;

public interface SaveFavouriteControllerCmd extends ControllerCommand {
	
	static final String defaultCommandClassName = "com.abc.commerce.favourites.commands.SaveFavouriteControllerCmdImpl";
	
	void setUserIdentifier(String userId);
	void setFavouriteColour(String color);
	void setFavouriteFood(String food);
	
	String getUserIdentifier();
	String getFavouriteColour();
	String getFavouriteFood();

}







-- /WebSphereCommerceServerExtensionsLogic/src/com/abc/commerce/favourites/commands/SaveFavouriteControllerCmdImpl.java

package com.abc.commerce.favourites.commands;

import java.util.List;
import java.util.logging.Logger;

import com.abc.commerce.favourites.objects.Favourite;
import com.abc.commerce.rating.persistence.FavouriteDaoImpl;
import com.ibm.commerce.command.ControllerCommandImpl;
import com.ibm.commerce.exception.ECException;
import com.ibm.commerce.foundation.logging.LoggingHelper;
import com.ibm.commerce.foundation.persistence.EntityDao;

public class SaveFavouriteControllerCmdImpl extends ControllerCommandImpl implements SaveFavouriteControllerCmd {
	
	private static final String CLASSNAME = SaveFavouriteControllerCmdImpl.class.getName();
	private static final Logger LOGGER = LoggingHelper.getLogger(SaveFavouriteControllerCmdImpl.class);

	private String userIdentifier;
	private String favouriteFood;
	private String favouriteColour;
	
	@Override
	public void setFavouriteColour(String color) {
		// TODO Auto-generated method stub
		favouriteColour = color;
	}

	@Override
	public void setFavouriteFood(String food) {
		// TODO Auto-generated method stub
		favouriteFood = food;
	}

	@Override
	public void setUserIdentifier(String userId) {
		// TODO Auto-generated method stub
		userIdentifier = userId;
	}

	public String getUserIdentifier() {
		return userIdentifier;
	}

	public String getFavouriteFood() {
		return favouriteFood;
	}

	public String getFavouriteColour() {
		return favouriteColour;
	}

	@Override
	public void performExecute() throws ECException {
		// TODO Auto-generated method stub
		super.performExecute();
		final String METHODNAME = "performExecute";
		LOGGER.info("Inside " + METHODNAME + " of " + CLASSNAME);
		
		EntityDao<Favourite, Long> favouriteDao = new FavouriteDaoImpl();
		List<Favourite> favouriteList = favouriteDao.query("Favourite.getFavouriteByUserId", userIdentifier);

		System.out.println("found record:" + favouriteList);
		
		// Already exist, update current favourite data and save
		if(favouriteList!=null && favouriteList.size()>0){
			Favourite favourite=(Favourite)favouriteList.get(0);
			if(favourite!=null){
				System.out.println("favouriteId: " + favourite.getFavouriteId());
				System.out.println("userId:" + favourite.getUserId());
				System.out.println("favouriteColor:" + favourite.getFavouriteColour());
				System.out.println("favouriteFood:" + favourite.getFavouriteFood());
				
				favourite.setFavouriteColour(getFavouriteColour());
				favourite.setFavouriteFood(getFavouriteFood());
				favouriteDao.persist(favourite);
				return;
			}
		} 
		
		// No existing data for userId, create new and save
		Favourite favourite = new Favourite();
		favourite.setUserId(userIdentifier);
		favourite.setFavouriteColour(favouriteColour);
		favourite.setFavouriteFood(favouriteFood);
		favourite.setFavouriteId(favouriteDao.generatePrimaryKey("X_CUSTOM_USER_INFORMATION"));
		favouriteDao.persist(favourite);
	}
}







-- /WebSphereCommerceServerExtensionsLogic/src/com/abc/commerce/favourites/handler/FavouriteHandler.java


package com.abc.commerce.favourites.handler;

import java.util.logging.Logger;

import javax.ws.rs.Encoded;
import javax.ws.rs.GET;
import javax.ws.rs.POST;
import javax.ws.rs.Path;
import javax.ws.rs.PathParam;
import javax.ws.rs.Produces;
import javax.ws.rs.QueryParam;
import javax.ws.rs.core.MediaType;
import javax.ws.rs.core.Response;

import org.springframework.web.bind.annotation.PathVariable;

import com.abc.commerce.favourites.commands.GetFavouriteControllerCmd;
import com.abc.commerce.favourites.commands.SaveFavouriteControllerCmd;
import com.abc.commerce.orders.command.GetProductRatingControllerCmd;
import com.abc.commerce.orders.command.SaveRatingCmd;
import com.abc.commerce.rest.rating.handler.RatingHandler;
import com.ibm.commerce.datatype.TypedProperty;
import com.ibm.commerce.foundation.common.util.logging.LoggingHelper;
import com.ibm.commerce.rest.classic.core.AbstractConfigBasedClassicHandler;

@Path("store/{storeId}/favourite")
@Encoded
public class FavouriteHandler extends AbstractConfigBasedClassicHandler {

	private static final String CLASSNAME=FavouriteHandler.class.getName();
	private static final Logger LOGGER = LoggingHelper.getLogger(FavouriteHandler.class);
	
	private static final String RESOURCE_NAME = "favourites";
	private static final String GET_FAVOURITE_DETAILS_PROFILE = "getFavouriteDetails";
	private static final String GET_FAVOURITE_DETAILS_DATABEAN_PATH = "{userId}";
	private static final String GET_FAVOURITE_DETAILS_DATABEAN_PROFILE = "getFavouriteDetailsDataBean";
	private static final String SAVE_FAVOURITE_DETAILS = "saveFavouriteDetails";
	
	@Override
	public String getResourceName() {
		// TODO Auto-generated method stub
		return RESOURCE_NAME;
	}
	
	@POST
	@Produces({ MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML,MediaType.APPLICATION_XHTML_XML, MediaType.APPLICATION_ATOM_XML })
	public Response saveFavourite(@PathParam("storeId") String storeId,
	  @QueryParam(value = "responseFormat") String responseFormat) {
		final String METHODNAME = "saveFavourite" ;
		LOGGER.info("Inside " + METHODNAME + " of " + CLASSNAME);
    
		Response result = prepareAndValidate(storeId, getResourceName(), "POST", request, responseFormat);
	    if (result != null) {
	    	if (LoggingHelper.isEntryExitTraceEnabled(LOGGER)) {
	    		LOGGER.exiting(CLASSNAME, METHODNAME, "SSL validation failed");
	    	}
	    	return result;
	    }
	    
	    try {
	    	result = executeConfigBasedCommandWithContext(SaveFavouriteControllerCmd.class.getName(), 
	    			    SAVE_FAVOURITE_DETAILS, responseFormat, storeId, null);
	    } catch (Exception e) {
	    	e.printStackTrace();
	    }
	    
	    return result;
	}
	
	@GET
	@Path(GET_FAVOURITE_DETAILS_DATABEAN_PATH)
	@Produces({ MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML,MediaType.APPLICATION_XHTML_XML, MediaType.APPLICATION_ATOM_XML })
	public Response getFavouritesByUserIdDatabean(@PathParam("storeId") String storeId,
	  @QueryParam(value = "responseFormat") String responseFormat,
	  @PathVariable(value = "userId") String userId) {
		final String METHODNAME = "getFavouritesByUserIdDatabean" ; 
	
		Response result = prepareAndValidate(storeId, getResourceName(), "GET", request, responseFormat);
	    if (result != null) {
	    	if (LoggingHelper.isEntryExitTraceEnabled(LOGGER)) {
	    		LOGGER.exiting(CLASSNAME, "renderOrder", "SSL validation failed");
	    	}
	    	return result;
	    }
	    
	    try {
			result = executeConfigBasedBeanWithContext("com.abc.commerce.favourites.beans.FavouriteDataBean", GET_FAVOURITE_DETAILS_DATABEAN_PROFILE, responseFormat, null);

	    } catch (Exception e) {
	    	result = handleException(responseFormat, e, METHODNAME);
	    }
	    
	    return result;
	}

	@GET
	@Produces({ MediaType.APPLICATION_JSON, MediaType.APPLICATION_XML,MediaType.APPLICATION_XHTML_XML, MediaType.APPLICATION_ATOM_XML })
	public Response getFavouritesByUserId(@PathParam("storeId") String storeId,
	  @QueryParam(value = "responseFormat") String responseFormat,
	  @QueryParam(value = "user_id") String user_id) {
		final String METHODNAME = "getFavouritesByUserId" ; 
		System.out.println("inside getFavouritesByUserId");
	    
		Response result = prepareAndValidate(storeId, getResourceName(), "POST", request, responseFormat);
	    if (result != null) {
	    	if (LoggingHelper.isEntryExitTraceEnabled(LOGGER)) {
	    		LOGGER.exiting(CLASSNAME, "renderOrder", "SSL validation failed");
	    	}
	    	return result;
	    }
	    
	    try {
	    	result = executeConfigBasedCommandWithContext(GetFavouriteControllerCmd.class.getName(), 
	    			    GET_FAVOURITE_DETAILS_PROFILE, responseFormat, storeId, null);
	    } catch (Exception e) {
	    	e.printStackTrace();
	    }
	    
	    return result;
	}

}





-- views-ext.xml where we map specific URL path of request coming to Store server to Views (jsp, jspf) in the Store server

<?xml version="1.0" encoding="UTF-8"?>

<!--
 =================================================================
  Licensed Materials - Property of HCL Technologies

  HCL Commerce

  (C) Copyright HCL Technologies Limited 1996, 2020

 =================================================================
-->
<beans xmlns="http://www.springframework.org/schema/beans" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xsi:schemaLocation="http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd">
  <!-- Add or import customer view definitions here 
  <import resource="classpath:/WEB-INF/spring/AuroraStorefrontAssetStore/{my-views.xml}"/> 
  <bean id="TopCategoriesDisplay/AuroraStorefrontAssetStore" class="com.ibm.commerce.store.mvc.view.spring.StoreInternalResourceView"> 
    <property name="url" value="/ShoppingArea/CatalogSection/CategorySubsection/MyTopCategoriesDisplay.jsp"/>  
    <property name="https" value="1"/>  
    <property name="credentialsAccepted" value="P"/> 
    <property name="generic" value="1"/>
  </bean>
  -->     
   <bean id="MyNewView" class="com.ibm.commerce.store.mvc.view.spring.StoreInternalResourceView"> 
    <property name="url" value="/Custom/MyNewView.jsp"/>  
    <property name="credentialsAccepted" value="P"/> 
    <property name="generic" value="1"/>
  </bean>
</beans>